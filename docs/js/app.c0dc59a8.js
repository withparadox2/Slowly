(function(t){function e(e){for(var a,r,o=e[0],c=e[1],l=e[2],d=0,h=[];d<o.length;d++)r=o[d],i[r]&&h.push(i[r][0]),i[r]=0;for(a in c)Object.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);u&&u(e);while(h.length)h.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],a=!0,o=1;o<n.length;o++){var c=n[o];0!==i[c]&&(a=!1)}a&&(s.splice(e--,1),t=r(r.s=n[0]))}return t}var a={},i={app:0},s=[];function r(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=t,r.c=a,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=e,o=o.slice();for(var l=0;l<o.length;l++)e(o[l]);var u=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"014d":function(t,e,n){"use strict";var a=n("fb4b"),i=n.n(a);i.a},"02b3":function(t,e,n){"use strict";var a=n("ff11"),i=n.n(a);i.a},"0591":function(t){t.exports={login_with_email:"透過電郵登入",verify_code:"驗證碼",sign_in:"登入",error_email:"請輸入正確的電郵格式",send_code_to:"驗證碼已發送至",input_code:"請輸入驗證碼",input_password:"請輸入密碼",send_passcode:"發送驗證碼",loading_profile:"加載個人信息...",change_location:"修改位置",change_locale:"切換語言",change_theme:"切換主题",about:"關於",change_log:"更新內容",feedback:"反饋",feedback_msg:"發送電郵到withparadox2@gmail.com",exit:"退出",warn_exit:"退出後數據仍在，是否確定退出?",tip:"提示",confirm:"確定",soft_confirm:"確定",cancel:"取消",loading:"正在加載...",close_map:"關閉地圖",update_location:"更新為選中的位置",locate_current_location:"定位當前位置",err_location_not_exist:"當前賬戶坐標信息不存在",err_account_not_exist:"賬戶不存在",err_not_select_correct:"未選中點",warn_update_location:"確定修改位置？",update_location_success:"修改成功",update_location_fail:"修改位置失敗",close:"關閉",history_letter:"歷史信件",send:"發送",write_words:"請寫下文字",uploading_photo:"正在上傳圖片...",sending:"正在發送...",saving_draft:"正在保存草稿...",loading_draft:"正在加載草稿...",err_load_draft_fail:"加載草稿失敗：",err_save_draft_fail:"保存草稿失敗：",warn_close_new_letter:"關閉後草稿將會保存到服务器，是否關閉？",input_content:"請輸入內容",warn_is_sending_to:"是否發送給{friend}？",add_photos:"添加圖片",stat_line1:"{date}這一天{fromUser}給{toUser}寫了第一封信",stat_line2:"距離現在已有{dayCount}天了",stat_line3:"你們一共寫了{letterCount}封信，包含整整{wordCount}個字",stat_line4:"你給“{friend}”寫了{letterCount}封信，包含{wordCount}個字",stat_line5:"“{friend}”給你寫了{letterCount}封信，包含{wordCount}個字",stat_line6:"特別的，在{date}這天，你們往來了{letterCount}封信",stat_line7:"你們有{dayCount}天沒有聯繫了",stat_month_list:"1月,2月,3月,4月,5月,6月,7月,8月,9月,10月,11月,12月",stat_week_list:"日,二,四,六",you:"你",stat_from:"來",stat_to:"往",stat_hover_date_str:"{date} 來{fromCount} 往{toCount}",delete:"刪除",email_placeholder:"郵箱",search_placeholder_prefix:"搜索",search_placeholder_suffix:"的信...",word_count:"字數",sender_name:"發信人",send_time:"發送時間",arrive_time:"送達時間",read_time:"閱讀時間",view_location:"查看位置",view_stat:"統計",new_letter:"新建",export_letters:"導出信件",last_letter:"上一封",next_letter:"下一封",name:"姓名",birthday:"生日",keep_secret:"保密",location:"位置",reply_time:"回复時間",login_time:"登錄時間",tip_sync_page:"正在同步第{pageIndex}頁",err_sync_fail:"同步失敗，請檢查網絡或重新登錄",warn_no_letter:"沒有信件",click_to_update:"點擊更新",about_poem:"子夜的燈\n是一條未穿衣裳的\n小河\n\n你的信像一尾魚游來\n讀水的溫暖\n讀你額上動人的鱗片\n\n讀江河如讀一面鏡\n讀鏡中你的笑\n如讀泡沫\n\n— 子夜讀信·洛夫",tip_copy_quote:"已復製到剪貼板",fail_to_load_profile:"加載個人信息失敗，是否要退出？",arrive_in_minutes:"{count}分鐘後送達",arrive_in_hours:"{count}小時內送達",warn_fail_to_load_draft:"草稿加載失敗，是否重試?"}},1:function(t,e){},"13b2":function(t,e,n){"use strict";var a=n("65ef"),i=n.n(a);i.a},1408:function(t){t.exports={login_with_email:"使用邮箱登陆",verify_code:"验证码",sign_in:"登入",error_email:"请输入正确的邮箱格式",send_code_to:"验证码已发送至",input_code:"请输入验证码",input_password:"请输入密码",send_passcode:"发送验证码",loading_profile:"加载个人信息...",change_location:"修改位置",change_locale:"切换语言",change_theme:"切换主题",about:"关于",change_log:"更新内容",feedback:"反馈",feedback_msg:"发送邮件到withparadox2@gmail.com",exit:"退出",warn_exit:"退出后数据仍在，是否确定退出?",tip:"提示",confirm:"确定",cancel:"取消",soft_confirm:"确定",loading:"正在加载...",close_map:"关闭地图",update_location:"更新为选中的位置",locate_current_location:"定位当前位置",err_location_not_exist:"当前账户坐标信息不存在",err_account_not_exist:"账户不存在",err_not_select_correct:"未选中点",warn_update_location:"确定修改位置？",update_location_success:"修改成功",update_location_fail:"修改位置失败",close:"关闭",history_letter:"历史信件",send:"发送",write_words:"请写下文字",uploading_photo:"正在上传图片...",sending:"正在发送...",saving_draft:"正在保存草稿...",loading_draft:"正在加载草稿...",err_load_draft_fail:"加载草稿失败：",err_save_draft_fail:"保存草稿失败：",warn_close_new_letter:"关闭后草稿将会保存到服务器，是否关闭？",input_content:"请输入内容",warn_is_sending_to:"是否发送给{friend}？",add_photos:"添加图片",stat_line1:"{date}这一天{fromUser}给{toUser}写了第一封信",stat_line2:"距离现在已有{dayCount}天了",stat_line3:"你们一共写了{letterCount}封信，包含整整{wordCount}个字",stat_line4:"你给“{friend}”写了{letterCount}封信，包含{wordCount}个字",stat_line5:"“{friend}”给你写了{letterCount}封信，包含{wordCount}个字",stat_line6:"特别的，在{date}这天，你们往来了{letterCount}封信",stat_line7:"你们有{dayCount}天没有联系了",stat_month_list:"1月,2月,3月,4月,5月,6月,7月,8月,9月,10月,11月,12月",stat_week_list:"日,二,四,六",you:"你",stat_from:"来",stat_to:"往",stat_hover_date_str:"{date} 来{fromCount} 往{toCount}",delete:"删除",email_placeholder:"邮箱",search_placeholder_prefix:"搜索",search_placeholder_suffix:"的信...",word_count:"字数",sender_name:"发信人",send_time:"发送时间",arrive_time:"送达时间",read_time:"阅读时间",view_location:"查看位置",view_stat:"统计",new_letter:"新建",export_letters:"导出信件",last_letter:"上一封",next_letter:"下一封",name:"姓名",birthday:"生日",keep_secret:"保密",location:"位置",reply_time:"回复时间",login_time:"登录时间",tip_sync_page:"正在同步第{pageIndex}页",err_sync_fail:"同步失败，请检查网络或重新登录",warn_no_letter:"没有信件",click_to_update:"点击更新",about_poem:"子夜的灯\n是一条未穿衣裳的\n小河\n\n你的信像一尾鱼游来\n读水的温暖\n读你额上动人的鳞片\n\n读江河如读一面镜\n读镜中你的笑\n如读泡沫\n\n— 子夜读信·洛夫",tip_copy_quote:"已复制到剪贴板",fail_to_load_profile:"加载个人信息失败，是否要退出？",arrive_in_minutes:"{count}分钟后送达",arrive_in_hours:"{count}小时内送达",warn_fail_to_load_draft:"草稿加载失败，是否重试?"}},1690:function(t,e,n){"use strict";var a=n("fa5a"),i=n.n(a);i.a},"1d46":function(t,e,n){},"1df3":function(t,e,n){},"1ec8":function(t,e){t.exports="data:image/png;base64,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"},2583:function(t,e,n){},2892:function(t,e,n){"use strict";var a=n("df96"),i=n.n(a);i.a},"2f2d":function(t,e,n){"use strict";var a=n("9fa2"),i=n.n(a);i.a},"350d":function(t,e,n){"use strict";var a=n("3f93"),i=n.n(a);i.a},"3f93":function(t,e,n){},"3f9f":function(t,e,n){},"3fb9":function(t,e,n){"use strict";var a=n("5f27"),i=n.n(a);i.a},"437e":function(t,e,n){},"4c86":function(t){t.exports={login_with_email:"Login with email",verify_code:"Passcode",sign_in:"Sign in",error_email:"Invalid email address ",send_code_to:"Passcode has been sent to ",input_code:"Please input passcode",input_password:"Please input password",send_passcode:"Send one-time passcode",loading_profile:"Loading personal profile...",change_location:"Change location",change_locale:"Change language",change_theme:"Change theme",about:"About",change_log:"Change log",feedback:"Feedback",feedback_msg:"Send email to withparadox2@gmail.com",exit:"Exit",warn_exit:"The data still exists, are you sure you want to exit?",tip:"Confirm",confirm:"Yes",cancel:"Cancel",soft_confirm:"Ok",loading:"Loading...",close_map:"Close map",update_location:"Set selected location as new location",locate_current_location:"Locate current location",err_location_not_exist:"Your location information is not existed",err_account_not_exist:"Your account is not existed",err_not_select_correct:"Please select a location first",warn_update_location:"Are you sure to update location?",update_location_success:"Update succeed",update_location_fail:"Update failed",close:"Close",history_letter:"Past letters",send:"Send",write_words:"Write down words",uploading_photo:"Uploading photos...",sending:"Sending...",saving_draft:"Saving draft...",loading_draft:"Loading draft...",err_load_draft_fail:"Loading draft failed：",err_save_draft_fail:"Saving draft failed：",warn_close_new_letter:"Draft will be saved to cloud after closing, are you sure to close?",input_content:"Please input content",warn_is_sending_to:"Is sending to {friend}?",add_photos:"Add photos",stat_line1:"On {date} {fromUser} sent the first letter to {toUser}",stat_line2:"{dayCount} days has passed since then",stat_line3:"You two have written {letterCount} letters to each other, containing {wordCount} words in total",stat_line4:"You have written {letterCount} letters to {friend}, containing {wordCount} words in total",stat_line5:"{friend} has written {letterCount} letters to you, containing {wordCount} words in total",stat_line6:"On {date}, specially, you wrote {letterCount} letters to each other",stat_line7:"You haven't been in touch for {dayCount} days",stat_month_list:"Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sept,Oct,Nov,Dec",stat_week_list:"Sun,Tue,Thu,Sat",you:"you",stat_from:"From",stat_to:"To",stat_hover_date_str:"{date} From {fromCount} To {toCount}",delete:"Delete",email_placeholder:"Email",search_placeholder_prefix:"Search in ",search_placeholder_suffix:"'s letters...",word_count:"Word count",sender_name:"Sender",send_time:"Send time",arrive_time:"Receive time",read_time:"Read time",view_location:"Location",view_stat:"Statistics",new_letter:"New letter",export_letters:"Export letters",last_letter:"Last letter",next_letter:"Next letter",name:"Name",birthday:"Birthday",keep_secret:"Unknown",location:"Location",reply_time:"Reply time",login_time:"Login time",tip_sync_page:"Synchronizing page {pageIndex}",err_sync_fail:"Synchronization failed, please check internet and relogin",warn_no_letter:"No letters",click_to_update:"Click to update",about_poem:"When I am dead, my dearest,\nSing no sad songs for me;\nPlant thou no roses at my head,\nNor shady cypress tree:\nBe the green grass above me\nWith showers and dewdrops wet;\nAnd if thou wilt, remember,\nAnd if thou wilt, forget.\n\nI shall not see the shadows,\nI shall not feel the rain;\nI shall not hear the nightingale\nSing on, as if in pain:\nAnd dreaming through the twilight\nThat doth not rise nor set,\nHaply I may remember,\nAnd haply may forget.\n\n— Christina Georgina Rossetti",tip_copy_quote:"Quote has been copied to clipboard",fail_to_load_profile:"Failed to update profile, do you want to exit?",arrive_in_minutes:"Arriving in 1 minute | Arriving in {count} minutes",arrive_in_hours:"Arriving in an hour | Arriving in {count} hours",warn_fail_to_load_draft:"Failed to load draft, do you want to try again?"}},5372:function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("a481"),n("7f7f");var a=n("a026");a["default"].directive("longpress",{bind:function(t,e,n){if("function"!==typeof e.value){var a=n.context.name,i="[longpress:] provided expression '".concat(e.expression,"' is not a function, but has to be");a&&(i+="Found in component '".concat(a,"' ")),console.warn(i)}var s=null,r=!1,o=function(t){r=!1,s=setTimeout(function(){r=!0,l(!1)},500)},c=function(t){!r&&t&&"mouseout"!=t.type&&l(!0),null!==s&&(clearTimeout(s),s=null)},l=function(t){e.value(t)};t.addEventListener("mousedown",o),t.addEventListener("touchstart",o),t.addEventListener("click",c),t.addEventListener("mouseout",c),t.addEventListener("touchend",c),t.addEventListener("touchcancel",c)}}),a["default"].filter("stampUrl",function(t){return"https://cdn.getslowly.com/assets/images/stamp/".concat(t,".png")});var i=n("8c4f"),s=n("5c96"),r=n.n(s),o=(n("0fae"),n("2583"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-wrapper"},[n("div",{staticClass:"container"},[n("div",{staticClass:"header"},[n("transition",{attrs:{name:"fade"}},[n("i",{directives:[{name:"show",rawName:"v-show",value:t.showSecondStage,expression:"showSecondStage"}],staticClass:"el-icon-back back-to-email",on:{click:t.backToEmail}})]),t._m(0),n("locale-switch",{staticClass:"locale-list"})],1),n("div",{staticClass:"form-wrapper"},[n("transition-group",{attrs:{name:t.fadeName,mode:"out-in"}},[n("div",{directives:[{name:"show",rawName:"v-show",value:!t.showSecondStage,expression:"!showSecondStage"}],key:1,staticClass:"content-wrapper"},[n("email-input",{ref:"emailInput",model:{value:t.email,callback:function(e){t.email=e},expression:"email"}}),n("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"login-button",attrs:{type:"primary",icon:"el-icon-message"},nativeOn:{click:function(e){return t.sendEmail(!0)}}},[t._v(t._s(t.$t("login_with_email")))])],1),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showSecondStage,expression:"showSecondStage"}],key:2,staticClass:"content-wrapper"},[n("el-input",{attrs:{spellcheck:"false","show-password":this.showPassword,placeholder:this.showPassword?t.$t("input_password"):t.$t("input_code")},model:{value:t.passcode,callback:function(e){t.passcode=e},expression:"passcode"}}),n("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:t.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"login-button",attrs:{type:"primary",icon:"el-icon-message"},nativeOn:{click:function(e){return t.login(e)}}},[t._v(t._s(t.$t("sign_in")))]),n("div",{directives:[{name:"show",rawName:"v-show",value:t.showPassword,expression:"showPassword"}],staticClass:"btn-send-passcode",on:{click:function(e){return t.sendEmail(!1)}}},[t._v(t._s(t.$t("send_passcode")))])],1)])],1)]),n("version")],1)}),c=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("a",{staticClass:"title-link",attrs:{href:"https://www.getslowly.com/en/"}},[n("span",{staticClass:"title"},[t._v("Slowly")])])}],l=(n("4917"),n("3b2b"),n("386d"),n("f559"),n("a925")),u=n("4c86"),d=n("1408"),h=n("0591"),f="local_select_locale",p="en",m="zh-CN",g="zh-TW",v=[{name:p,text:"English",message:u},{name:m,text:"中文-简体",message:d},{name:g,text:"中文-繁體",message:h}],_=v.reduce(function(t,e){return t[e.name]=e.message,t},{});function w(){var t=L();if(t)return t;var e=navigator&&(navigator.language||navigator.userLanguage);return e&_[e]?e:e&&e.startsWith("zh")?e===m?m:g:p}a["default"].use(l["a"]);var b=new l["a"]({locale:w(),messages:_}),y=b;function C(){return v}function k(t){t&&localStorage.setItem(f,t),b.locale=t}function L(){return localStorage.getItem(f)}function S(t){var e=/\S+@\S+\.\S+/;return e.test(t)}function x(t,e){t.$message({showClose:!0,message:e,type:"error"})}function I(t,e){t.$message({showClose:!0,message:e,type:"success"})}function A(t){var e=M(t);return O(e)}function M(t,e){var n;return t instanceof Date||(t=V(t)),n=e?t.getTime()+6e4*t.getTimezoneOffset():t.getTime()-6e4*t.getTimezoneOffset(),new Date(n)}function O(t){var e=t.getFullYear(),n=t.getDate(),a=t.getMonth()+1;n<10&&(n="0"+n),a<10&&(a="0"+a);var i=e+"-"+a+"-"+n,s=t.getHours(),r=t.getMinutes(),o=t.getSeconds();return s<10&&(s="0"+s),r<10&&(r="0"+r),o<10&&(o="0"+o),i+" "+s+":"+r+":"+o}function $(t){return"".concat(t.getFullYear(),"-").concat(t.getMonth()<9?"0":"").concat(t.getMonth()+1,"-").concat(t.getDate()<10?"0":"").concat(t.getDate())}function F(t,e){var n=864e5;return Math.round(Math.abs((t.getTime()-e.getTime())/n))}Date.prototype.addDays=function(t){var e=new Date(this.valueOf());return e.setDate(e.getDate()+t),e};var E=new Intl.DateTimeFormat("en",{year:"numeric",month:"2-digit",day:"2-digit",hour12:!0,hour:"numeric",minute:"numeric"});function j(t){if("en"===y.locale)return E.format(t);var e,n=t.getFullYear(),a=t.getMonth()+1,i=t.getDate(),s=t.getHours(),r=t.getMinutes(),o=new Date;if(n!=(new Date).getFullYear())return"".concat(n%100,"年").concat(a,"月").concat(i,"日");a==o.getMonth()+1&&(i==o.getDate()?e="今天":i==o.getDate()-1&&(e="昨天")),e||(e="".concat(a,"月").concat(i,"日"));var c="".concat(s>12?s-12:s,":").concat(r<10?"0"+r:r);return"".concat(e," ").concat(c," ").concat(D(s))}function D(t){return 1<=t&&t<=4?"凌晨":5<=t&&t<=7?"清晨":8<=t&&t<=10?"上午":11<=t&&t<=13?"中午":14<=t&&t<=16?"下午":17<=t&&t<=18?"傍晚":19<=t&&t<=21?"晚上":"深夜"}function T(t){var e=document.createElement("textarea");e.value=t,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)}function N(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=window.location.search,a=new RegExp("[&?]"+t+"=([^&?]*)"),i=n.match(a);return i?decodeURIComponent(i[1]):e}function V(t){var e=t.substring(5,10).replace("-","/")+"/"+t.substring(0,4)+t.substring(10);return new Date(e)}function R(t){if(!t)return 0;for(var e=0,n=!1,a=0;a<t.length;a++){var i=t.charCodeAt(a);48<=i&&i<=57||65<=i&&i<=90||97<=i&&i<=122?n=!0:(n&&(n=!1,e++),(i>=128||i<0)&&e++)}return n&&e++,e}function P(){var t=navigator.userAgent||navigator.vendor||window.opera;return!!/windows phone/i.test(t)||(!!/android/i.test(t)||!(!/iPad|iPhone|iPod/.test(t)||window.MSStream))}var q,B,Q=n("0a0d"),U=n.n(Q),G=n("e814"),z=n.n(G),H=n("795b"),W=n.n(H),Y=(n("ac6a"),n("5df3"),n("f499")),X=n.n(Y),J=n("a4bb"),Z=n.n(J),K=n("bc3a"),tt=n.n(K),et="slowly-key-token",nt="slowly-key-account";function at(){return q||(q=localStorage.getItem(et)),q}function it(t){q=t,localStorage.setItem(et,q)}function st(){if(!B){var t=localStorage.getItem(nt);try{B=t?JSON.parse(t):null}catch(e){rt(""),B=null}}return B}function rt(t){B=t,localStorage.setItem(nt,X()(t))}function ot(){it(""),rt("")}var ct="https://api.getslowly.com";function lt(t,e){if(!e||0==Z()(e).length)return t;var n="";for(var a in e)0!=n.length&&(n+="&"),n+="".concat(encodeURIComponent(a),"=").concat(encodeURIComponent(e[a]));return"".concat(t).concat(t.indexOf("?")>=0?"&":"?").concat(n)}function ut(t,e){return t||(t={}),e&&(t.token=at()),t}function dt(t){var e=t.path,n=t.params,a=t.content,i=t.noAuth,s=void 0!==i&&i,r=t.headers;return tt()({method:"post",url:ft({path:e,params:n,noAuth:s}),data:a,headers:r}).catch(function(t){return W.a.reject({error:t,message:pt(t)})})}function ht(t){var e=t.path,n=t.params,a=t.noAuth,i=void 0!==a&&a;return tt.a.get(ft({path:e,params:n,noAuth:i})).catch(function(t){return W.a.reject({error:t,message:pt(t)})})}function ft(t){var e=t.path,n=t.params,a=t.noAuth,i=void 0!==a&&a;return n=ut(n,!i),lt(ct+e,n)}function pt(t){return t.response&&t.response.data?t.response.data.error?t.response.data.error:X()(t.response.data):t.message?t.message:"unknown error"}n("28a5"),n("6b54");var mt=n("85f2"),gt=n.n(mt);function vt(){function t(t){!function(e,a){if("function"==typeof define&&n("3c35"))define(["exports"],a);else if(void 0!==t)a(t);else{var i={};a(i),e.Hashids=i}}(this,function(t){function e(t,e){for(var n=0;n<e.length;n++){var a=e[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),gt()(t,a.key,a)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var i,s,r="";this.escapeRegExp=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},this.parseInt=function(t,e){return/^(-|\+)?([0-9]+|Infinity)$/.test(t)?z()(t,e):NaN},this.seps="cfhistuCFHISTU",this.minLength=0<z()(n,10)?n:0,this.salt="string"==typeof e?e:"","string"==typeof a&&(this.alphabet=a);for(var o=0;o!==this.alphabet.length;o++)-1===r.indexOf(this.alphabet.charAt(o))&&(r+=this.alphabet.charAt(o));if(this.alphabet=r,this.alphabet.length<16)throw"error: alphabet must contain at least X unique characters".replace("X",16);if(-1!==this.alphabet.search(" "))throw"error: alphabet cannot contain spaces";for(var c=0;c!==this.seps.length;c++){var l=this.alphabet.indexOf(this.seps.charAt(c));-1===l?this.seps=this.seps.substr(0,c)+" "+this.seps.substr(c+1):this.alphabet=this.alphabet.substr(0,l)+" "+this.alphabet.substr(l+1)}this.alphabet=this.alphabet.replace(/ /g,""),this.seps=this.seps.replace(/ /g,""),this.seps=this._shuffle(this.seps,this.salt),(!this.seps.length||3.5<this.alphabet.length/this.seps.length)&&(i=Math.ceil(this.alphabet.length/3.5))>this.seps.length&&(s=i-this.seps.length,this.seps+=this.alphabet.substr(0,s),this.alphabet=this.alphabet.substr(s)),this.alphabet=this._shuffle(this.alphabet,this.salt);var u=Math.ceil(this.alphabet.length/12);this.alphabet.length<3?(this.guards=this.seps.substr(0,u),this.seps=this.seps.substr(u)):(this.guards=this.alphabet.substr(0,u),this.alphabet=this.alphabet.substr(u))}var n,a;return n=t,(a=[{key:"encode",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(!e.length)return"";if(e[0]&&e[0].constructor===Array&&!(e=e[0]).length)return"";for(var a=0;a!==e.length;a++)if(e[a]=this.parseInt(e[a],10),!(0<=e[a]))return"";return this._encode(e)}},{key:"decode",value:function(t){return t&&t.length&&"string"==typeof t?this._decode(t,this.alphabet):[]}},{key:"encodeHex",value:function(t){if(t=t.toString(),!/^[0-9a-fA-F]+$/.test(t))return"";for(var e=t.match(/[\w\W]{1,12}/g),n=0;n!==e.length;n++)e[n]=z()("1"+e[n],16);return this.encode.apply(this,e)}},{key:"decodeHex",value:function(t){for(var e=[],n=this.decode(t),a=0;a!==n.length;a++)e+=n[a].toString(16).substr(1);return e}},{key:"_encode",value:function(t){for(var e,n=this.alphabet,a=0,i=0;i!==t.length;i++)a+=t[i]%(i+100);for(var s=e=n.charAt(a%n.length),r=0;r!==t.length;r++){var o=t[r],c=s+this.salt+n;n=this._shuffle(n,c.substr(0,n.length));var l=this._toAlphabet(o,n);if(e+=l,r+1<t.length){var u=(o%=l.charCodeAt(0)+r)%this.seps.length;e+=this.seps.charAt(u)}}if(e.length<this.minLength){var d=(a+e[0].charCodeAt(0))%this.guards.length,h=this.guards[d];(e=h+e).length<this.minLength&&(d=(a+e[2].charCodeAt(0))%this.guards.length,e+=h=this.guards[d])}for(var f=z()(n.length/2,10);e.length<this.minLength;){var p=(e=(n=this._shuffle(n,n)).substr(f)+e+n.substr(0,f)).length-this.minLength;0<p&&(e=e.substr(p/2,this.minLength))}return e}},{key:"_decode",value:function(t,e){var n=[],a=0,i=new RegExp("[".concat(this.escapeRegExp(this.guards),"]"),"g"),s=t.replace(i," "),r=s.split(" ");if(3!==r.length&&2!==r.length||(a=1),void 0!==(s=r[a])[0]){var o=s[0];s=s.substr(1),i=new RegExp("[".concat(this.escapeRegExp(this.seps),"]"),"g"),r=(s=s.replace(i," ")).split(" ");for(var c=0;c!==r.length;c++){var l=r[c],u=o+this.salt+e;e=this._shuffle(e,u.substr(0,e.length)),n.push(this._fromAlphabet(l,e))}this.encode(n)!==t&&(n=[])}return n}},{key:"_shuffle",value:function(t,e){var n;if(!e.length)return t;for(var a=(t=t.split("")).length-1,i=0,s=0,r=0;0<a;a--,i++){i%=e.length,s+=n=e.charCodeAt(i);var o=t[r=(n+i+s)%a];t[r]=t[a],t[a]=o}return t.join("")}},{key:"_toAlphabet",value:function(t,e){for(var n="";n=e.charAt(t%e.length)+n,t=z()(t/e.length,10););return n}},{key:"_fromAlphabet",value:function(t,e){return t.split("").map(function(t){return e.indexOf(t)}).reduce(function(t,n){return t*e.length+n},0)}}])&&e(n.prototype,a),t}();t.default=n})}var e={};return t(e),e.default}function _t(t,e){var n=vt();return new n("+DP;=SW`DGX&n|]OGoGkj/4XqPw?^Fclc2F-_V~D=rquG+L(kW_xzVR=slp+Yj;B",30).encode(z()(t),z()(e||0),Math.floor(1e5+9e5*Math.random()))}function wt(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return dt({path:"/auth/email/passcode",noAuth:!0,content:{email:t,device:"web",checkpass:e}})}function bt(t,e){return dt({path:"/auth/email",noAuth:!0,content:{email:t,device:"web",passcode:e}})}function yt(t,e){return dt({path:"/auth/email/password",noAuth:!0,content:{email:t,device:"web",password:e}})}function Ct(){return ht({path:"/users/me/friends/v2",params:{requests:1}})}function kt(t,e){return ht({path:"/friend/".concat(t,"/all"),params:{ver:2,page:e}})}function Lt(t){return jt({params:{}})}function St(t){var e=t.id,n=t.letter,a=t.isHost,i=t.attachments,s=t.stamp;return dt({path:"/posts/".concat(e,"/reply"),content:{body:n,attachments:i,style:{},stamp:s||"free",host:a}})}function xt(t,e){return It(t,e).then(function(n){return jt({content:{language:null,location:"".concat(t,",").concat(e),location_code:n,device:"web",ver:30200,includes:null}})})}function It(t,e){return dt({path:"/geocode",content:{lat:t,lng:e}}).then(function(t){return t.data[0].properties.countryCode})}function At(t){return ft({path:"/attachments/".concat(t)})}function Mt(t){return ft({path:"/attachments",params:{post:t}})}function Ot(t,e){return W.a.all(e.map(function(e){return $t(t,e)}))}function $t(t,e){var n=new FormData;return n.append("image",e),dt({path:"/attachments",params:{post:t},content:n})}function Ft(t){return dt({path:"/letter/read",content:{ids:t}})}function Et(){return W.a.resolve({data:{now:z()(U()()/1e3+60)}})}function jt(t){var e=t.params,n=t.content;return Et().then(function(t){var a=t.data.now,i=st(),s=_t(a,i&&i.id);return e?e.otp=s:n&&(n.otp=s),dt({path:"/users/me/v2",content:n,params:e})})}function Dt(){return ht({path:"/letter/incoming"})}function Tt(t){return dt({path:"/web/drafts/get",content:{post:t}})}function Nt(t){var e=t.friendId,n=t.body,a=t.stamp,i=t.attachments;return dt({path:"/web/drafts/save",content:{post:e,user_id:null,body:n,stamp:a,attachments:i,channel:"web",audio:null}})}var Vt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("el-popover",{attrs:{placement:"bottom","popper-class":"email-popover",width:"50%",trigger:"manual"},model:{value:t.visible,callback:function(e){t.visible=e},expression:"visible"}},[n("div",t._l(t.cachedEmails,function(e){return n("div",{key:e,staticClass:"item",on:{click:function(n){return t.checkEmail(e)}}},[n("el-row",{attrs:{type:"flex"}},[n("el-col",{attrs:{span:20}},[t._v(t._s(e))]),n("el-col",{staticClass:"el-remove-email",attrs:{span:4,title:t.$t("delete")},nativeOn:{click:function(n){return n.stopPropagation(),t.removeEmail(e)}}},[n("i",{staticClass:"el-icon-delete"})])],1)],1)}),0),n("el-input",{attrs:{slot:"reference",value:t.value,spellcheck:"false",clearable:!0,placeholder:t.$t("email_placeholder")},on:{input:function(e){return t.$emit("input",e)}},slot:"reference"})],1)],1)},Rt=[],Pt={data:function(){return{visible:!1,cachedEmails:[]}},props:{value:{type:String,required:!0}},watch:{value:function(){this.setPopupState()}},methods:{save:function(t){t||(t=this.value);var e=this.loadEmails().filter(function(e){return e!=t});e.splice(0,0,t),this.saveEmails(e)},loadEmails:function(){return JSON.parse(localStorage.getItem("email-cache-json")||"[]")||[]},saveEmails:function(t){localStorage.setItem("email-cache-json",X()(t))},checkEmail:function(t){var e=this;this.$emit("input",t),this.$nextTick(function(){e.visible=!1})},removeEmail:function(t){this.saveEmails(this.loadEmails().filter(function(e){return e!=t})),this.setPopupState()},setPopupState:function(){var t=this;this.cachedEmails=this.loadEmails().filter(function(e){return e.indexOf(t.value)>=0}),this.visible=!!(this.value&&this.cachedEmails.length>0)}},mounted:function(){var t=this.loadEmails();t.length>0&&this.checkEmail(t[0])}},qt=Pt,Bt=(n("eb33"),n("2877")),Qt=Object(Bt["a"])(qt,Vt,Rt,!1,null,null,null),Ut=Qt.exports,Gt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.newVersion?n("div",{staticClass:"new-version",on:{click:function(e){return t.updateNewVersion()}}},[n("div",[t._v(t._s(t.$t("click_to_update")))]),t.newVersion.content&&t.newVersion.content.length>0?n("ul",t._l(t.newVersion.content,function(e){return n("li",{key:e},[n("span",[t._v(t._s(e))])])}),0):t._e()]):t._e()},zt=[],Ht=n("cebc"),Wt=n("2f62"),Yt={versionName:"2.4.2",versionCode:88,content:["We love Slowly!"]};window.appVersion={versionName:"2.4.2",versionCode:88,content:["We love Slowly!"]};var Xt="key_url_timestamp",Jt="t";function Zt(t){return t&&t.length>0&&t.forEach(function(t){t.contentItems="string"===typeof t.content?t.content.split("\n"):t.content}),t}function Kt(){return new W.a(function(t,e){tt()({method:"get",url:"./change-log.json?t=".concat(U()())}).then(function(e){if(e.data&&e.data.length>0){Zt(e.data);var n=e.data[0];t({newVersion:n&&n.versionCode>Yt.versionCode?{content:n.contentItems}:null,changeLog:e.data})}else t(!1)}).catch(function(e){console.error(e),t(!1)})})}function te(t){var e=window.location,n="".concat(Jt,"=").concat(t);if(e.search){var a=e.search.match(new RegExp("[&?](".concat(Jt,"=[^&?]*)")));n=a?e.search.replace(a[1],n):e.search+"&"+n}else n="?"+n;return e.origin+e.pathname+n+e.hash}function ee(t){localStorage.setItem(Xt,t),window.location.href=te(t)}function ne(){ee(U()())}function ae(){var t=localStorage.getItem(Xt);"null"==t&&(localStorage.removeItem(Xt),t=null);var e=N(Jt);if(t){if(!e||e<t)return ee(t),!0}else e&&localStorage.setItem(Xt,e);return!1}var ie={data:function(){return{newVersion:!1}},methods:Object(Ht["a"])({},Object(Wt["b"])(["setChangeLog"]),{updateNewVersion:function(){ne()}}),mounted:function(){var t=this;Kt().then(function(e){e&&(e.newVersion&&(t.newVersion=e.newVersion),t.setChangeLog(e.changeLog))})}},se=ie,re=(n("3fb9"),Object(Bt["a"])(se,Gt,zt,!1,null,"b1917034",null)),oe=re.exports,ce=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-dropdown",{ref:"dropdown",attrs:{trigger:"click"}},[n("span",[t._v(t._s(t.activeLocale))]),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},t._l(t.localeList,function(e){return n("el-dropdown-item",{key:e.name,class:{fontbold:e.name===t.$i18n.locale},nativeOn:{click:function(n){return t.changeLocale(e)}}},[t._v(t._s(e.text))])}),1)],1)},le=[],ue={computed:{localeList:function(){return C()},activeLocale:function(){var t=this;return this.localeList.filter(function(e){return e.name===t.$i18n.locale})[0].text}},methods:{show:function(){this.$refs.dropdown.show()},changeLocale:function(t){k(t.name)}}},de=ue,he=Object(Bt["a"])(de,ce,le,!1,null,null,null),fe=he.exports,pe={data:function(){return{email:"",passcode:"",fullscreenLoading:!1,showPasscode:!1,showPassword:!1}},components:{EmailInput:Ut,Version:oe,LocaleSwitch:fe},computed:{fadeName:function(){return this.showSecondStage?"slide-in":"slide-out"},showSecondStage:function(){return this.showPassword||this.showPasscode}},methods:{sendEmail:function(t){var e=this;S(this.email)?(this.fullscreenLoading=!0,wt(this.email,t).then(function(t){e.fullscreenLoading=!1,t.data&&t.data.hasPassword?(e.showPassword=!0,e.showPasscode=!1,e.$refs.emailInput.save()):t.data&&t.data.success&&(I(e,"".concat(e.$t("send_code_to")).concat(e.email)),e.showPassword=!1,e.showPasscode=!0,e.$refs.emailInput.save())}).catch(function(t){e.fullscreenLoading=!1,e.$errorHandler(t)})):x(this,this.$t("error_email"))},login:function(){var t=this;if(this.passcode){this.fullscreenLoading=!0;var e=this.showPassword?yt:bt;e(this.email,this.passcode).then(function(e){t.fullscreenLoading=!1,e&&e.data&&e.data.token&&(it(e.data.token),t.$router.replace({name:"home"}))}).catch(function(e){t.fullscreenLoading=!1,t.$errorHandler(e)})}else x(this,this.showPassword?this.$t("input_password"):this.$t("input_code"))},backToEmail:function(){this.showPasscode=!1,this.showPassword=!1}},mounted:function(){at()&&this.$router.replace({name:"home"})}},me=pe,ge=(n("2892"),Object(Bt["a"])(me,o,c,!1,null,"2be407be",null)),ve=ge.exports,_e=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container",class:{"mobile-mode":t.mobileMode,"tablet-mode":t.tabletMode,mobile:t.isMobileEnv}},[t.accountInfo?[n("div",{staticClass:"nav-header"},[n("img",{staticClass:"logo",attrs:{src:t.logo}}),n("span",{staticClass:"title"},[t._v("Slowly")]),n("div",{staticClass:"middle"},[t.checkedFriend?n("input-box"):t._e()],1),n("locale-switch",{ref:"localeList",staticClass:"menu-locale-list"}),n("el-dropdown",{staticClass:"menu-more",attrs:{trigger:"click"}},[n("i",{staticClass:"el-icon-more"}),t._v("`\n        "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{nativeOn:{click:function(e){return t.editLocation(e)}}},[t._v(t._s(t.$t("change_location")))]),n("el-dropdown-item",{nativeOn:{click:function(e){return t.$refs.localeList.show()}}},[t._v(t._s(t.$t("change_locale")))]),n("el-dropdown-item",{nativeOn:{click:function(e){return t.setTheme(!t.nightMode)}}},[t._v(t._s(t.$t("change_theme")))]),n("el-dropdown-item",{nativeOn:{click:function(e){return t.showChangeLog(e)}}},[t._v(t._s(t.$t("change_log")))]),n("el-dropdown-item",{nativeOn:{click:function(e){return t.showFeedback(e)}}},[t._v(t._s(t.$t("feedback")))]),n("el-dropdown-item",{nativeOn:{click:function(e){return t.showAbout(e)}}},[t._v(t._s(t.$t("about")))]),n("el-dropdown-item",{nativeOn:{click:function(e){return t.exit()}}},[t._v(t._s(t.$t("exit")))])],1)],1)],1),n("div",{staticClass:"main-content"},[n("div",{staticClass:"left-section",class:{"left-section-exited":t.leftSectionExited}},[t.tabletMode?n("div",{staticClass:"sidebar-header"},[n("i",{staticClass:"icon-nav",class:{"el-icon-arrow-right":t.leftSectionExited,"el-icon-arrow-left":!t.leftSectionExited},on:{click:function(e){t.leftSectionExited=!t.leftSectionExited}}})]):t._e(),n("div",{staticClass:"sidebar-content soft-scrollable"},[n("friends",{attrs:{isExpand:!t.leftSectionExited}})],1)]),n("div",{staticClass:"left-section-overlay",class:{entered:t.tabletMode&&!t.leftSectionExited},on:{click:function(e){t.leftSectionExited=!0}}}),n("div",{staticClass:"right-section"},[n("letters",{directives:[{name:"show",rawName:"v-show",value:t.checkedFriend,expression:"checkedFriend"}],on:{showMap:function(e){return t.showMap(e)}}}),n("quote-node",{directives:[{name:"show",rawName:"v-show",value:!t.checkedFriend,expression:"!checkedFriend"}]})],1)]),n("version"),n("map-node",{ref:"map"}),n("about",{ref:"about"}),n("change-log",{ref:"changeLog"})]:n("div",{directives:[{name:"loading",rawName:"v-loading",value:!t.accountInfo,expression:"!accountInfo"}],attrs:{id:"account-loading","element-loading-background":t.nightMode?"#0c0b09":"white","element-loading-text":t.$t("loading_profile")}})],2)},we=[],be=n("a745"),ye=n.n(be),Ce=(n("96cf"),n("3b8d")),ke=n("7618"),Le=1,Se="friends",xe="letters",Ie="draft";function Ae(t){var e=t.target.result;t.oldVersion<1&&(Me(e,Se,"user_id"),Me(e,xe,"id",{owner_id:!1}),Me(e,Ie,"user_id"))}function Me(t,e,n,a){if(t.objectStoreNames.contains(e))return!1;var i=n?t.createObjectStore(e,{keyPath:n}):t.createObjectStore(e,{autoIncrement:!0});if(a&&"object"==Object(ke["a"])(a))for(var s in a)a.hasOwnProperty(s)&&i.createIndex(s,s,{unique:!!a[s]})}var Oe=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,$e=null;function Fe(){var t=st();return t?"".concat(t.id,"-slowly"):"slowly"}function Ee(){return new W.a(function(t,e){je();var n=Oe.open(Fe(),Le);n.onupgradeneeded=Ae,n.onerror=function(t){$e=null,e(t.target.error)},n.onsuccess=function(e){$e=e.target.result,t($e)}})}function je(){$e&&($e.close(),$e=null)}function De(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new W.a(function(){var n=Object(Ce["a"])(regeneratorRuntime.mark(function n(a,i){var s,r,o;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Ee();case 3:s=$e.transaction([t],"readonly"),r=s.objectStore(t),o=e?r.get(e):r.getAll(),o.onsuccess=function(t){a(t.target.result)},o.onerror=function(t){i(t.target.error)},n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](0),i(n.t0);case 13:case"end":return n.stop()}},n,null,[[0,10]])}));return function(t,e){return n.apply(this,arguments)}}())}function Te(t,e,n){return new W.a(function(){var a=Object(Ce["a"])(regeneratorRuntime.mark(function a(i,s){var r,o,c,l;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Ee();case 3:r=$e.transaction([t],"readonly"),o=r.objectStore(t),c=o.index(e),l=c.getAll(n),l.onsuccess=function(t){i(t.target.result)},l.onerror=function(t){s(t.target.error)},a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](0),s(a.t0);case 14:case"end":return a.stop()}},a,null,[[0,11]])}));return function(t,e){return a.apply(this,arguments)}}())}function Ne(t){return ye()(t)?t:[t]}function Ve(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e=Ne(e),new W.a(function(){var n=Object(Ce["a"])(regeneratorRuntime.mark(function n(a,i){var s,r;return regeneratorRuntime.wrap(function(n){while(1)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,Ee();case 3:s=$e.transaction([t],"readwrite"),r=s.objectStore(t),e.forEach(function(t){r.add(t)}),s.oncomplete=function(t){a(t.target.result)},s.onerror=function(t){i(t.target.error)},n.next=13;break;case 10:n.prev=10,n.t0=n["catch"](0),i(n.t0);case 13:case"end":return n.stop()}},n,null,[[0,10]])}));return function(t,e){return n.apply(this,arguments)}}())}function Re(t,e,n){return new W.a(function(){var a=Object(Ce["a"])(regeneratorRuntime.mark(function a(i,s){var r,o,c;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Ee();case 3:r=$e.transaction([t],"readwrite"),o=r.objectStore(t),r.oncomplete=function(t){i(t.target.result)},r.onerror=function(t){s(t.target.error)},c=o.openCursor(n),c.onsuccess=function(t){var n=t.target.result;n?n.update(e):o.add(e)},a.next=14;break;case 11:a.prev=11,a.t0=a["catch"](0),s(a.t0);case 14:case"end":return a.stop()}},a,null,[[0,11]])}));return function(t,e){return a.apply(this,arguments)}}())}function Pe(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e=Ne(e),new W.a(function(){var a=Object(Ce["a"])(regeneratorRuntime.mark(function a(i,s){var r,o;return regeneratorRuntime.wrap(function(a){while(1)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,Ee();case 3:r=$e.transaction([t],"readwrite"),o=r.objectStore(t),r.oncomplete=function(t){i(t.target.result)},r.onerror=function(t){s(t.target.error)},e.forEach(function(t){o.delete(n?t[n]:t)}),a.next=13;break;case 10:a.prev=10,a.t0=a["catch"](0),s(a.t0);case 13:case"end":return a.stop()}},a,null,[[0,10]])}));return function(t,e){return a.apply(this,arguments)}}())}function qe(t){return new W.a(function(){var e=Object(Ce["a"])(regeneratorRuntime.mark(function e(n,a){var i,s,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ee();case 3:i=$e.transaction([t],"readwrite"),s=i.objectStore(t),r=s.clear(),r.onsuccess=function(t){n(t.target.readyState)},r.onerror=function(t){a(t.target.error)},e.next=13;break;case 10:e.prev=10,e.t0=e["catch"](0),a(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(t,n){return e.apply(this,arguments)}}())}function Be(){return De(Se)}function Qe(t){return qe(Se).then(function(){return Ve(Se,t)})}n("55dd");var Ue=n("75fc"),Ge=n("d225"),ze=n("b0b4"),He=0,We=1,Ye=2,Xe=3,Je=4,Ze=5,Ke=function(){function t(e){Object(Ge["a"])(this,t),this.friend=e,this.userId=e.id,this.syncPage=1,this.syncState=He,this.dataList=[],this.syncDataList=[]}return Object(ze["a"])(t,[{key:"setCallback",value:function(t){return this.callback=t,this}},{key:"doCallback",value:function(){this.callback&&this.callback(this,{isRefresh:this.syncState==Xe,isSync:this.syncState==Ye,isSuccess:this.syncState==Je,dataList:this.dataList.map(function(t){return t.body=t.body||"",t})})}},{key:"requestData",value:function(){var t=this;this.syncState>He&&this.syncState<Je?this.doCallback():(this.syncState=We,this.syncPage=1,this.dataList=[],this.syncDataList=[],nn(this.userId).then(function(e){if(e&&0!=e.length){t.dataList=t.sortList(e);var n=window.__CONFIG__.useCache||t.friend.lastRefreshTime&&U()()-t.friend.lastRefreshTime<6e5;n?(t.syncState=Je,t.doCallback()):(t.syncState=Xe,t.doCallback(),t.loadServerLetters(1))}else t.syncState=Ye,t.doCallback(),t.loadServerLetters(t.syncPage)}).catch(function(t){console.error(t)}))}},{key:"bindThis",value:function(t){return t.bind(this)}},{key:"loadServerLetters",value:function(t){var e=this;kt(this.userId,t).then(this.getResultHandler(t)).catch(function(t){console.error(t),e.syncState=Ze,e.doCallback()})}},{key:"getResultHandler",value:function(t){function e(e){var n=this,i=e.data;i.user&&a["default"].set(this.friend,"last_login",i.user.last_login),i.post&&a["default"].set(this.friend,"share_photos",i.post.user_photos);var s,r=this.sortList([].concat(Object(Ue["a"])(i.incoming||[]),Object(Ue["a"])(i.comments.data||[]))),o=!!i.comments.next_page_url;if(this.syncState==Xe){var c=this.subListTo(r,this.dataList[0]);c<0?this.syncState=Ye:(this.updateLetters(r),this.friend.lastRefreshTime=U()(),this.syncState=Je,nn(this.userId).then(function(t){n.dataList=n.sortList(t),n.doCallback()}))}this.syncState==Ye&&((s=this.syncDataList).push.apply(s,Object(Ue["a"])(r)),o?(this.syncPage=t+1,this.loadServerLetters(this.syncPage),this.doCallback()):(this.syncState=Je,this.dataList=this.sortList(this.syncDataList),Pe(xe,this.syncDataList,"id"),this.insertLetters(this.dataList),this.doCallback()))}return e.bind(this)}},{key:"subListTo",value:function(t,e){for(var n=0;n<t.length;n++)if(t[n].id==e.id)return n;return-1}},{key:"sortList",value:function(t){return t.sort(function(t,e){return e.id-t.id}),t}},{key:"clearLetters",value:function(t){return Pe(xe,t,"letter_id")}},{key:"insertLetters",value:function(t){var e=this;return t.forEach(function(t){t.owner_id=e.userId}),Ve(xe,t)}},{key:"updateLetters",value:function(t){var e=this;t.forEach(function(t){t.owner_id=e.userId,Re(xe,t,t.id)})}}]),t}(),tn={};function en(t){return tn[t.id]||(tn[t.id]=new Ke(t)),tn[t.id]}function nn(t){return Te(xe,"owner_id",t)}function an(t,e){e.owner_id=t.user_id,Re(xe,e,e.id)}function sn(t){return t=t||[],t.sort(function(t,e){return t.latest_comment?e.latest_comment?-t.latest_comment.localeCompare(e.latest_comment):-1:1}),t}function rn(t,e){t.$nextTick(function(){var n=t.$el.querySelector(e);n&&(n.scrollTop=0)})}function on(t,e){var n=-1,a=setInterval(function(){n>=t.scrollTop?(e&&e(),clearInterval(a)):n=t.scrollTop},20)}function cn(t,e){var n=new Blob([(e||[]).map(function(t){return ln(t)}).join("\n\n\n\n")],{type:"text/plain"}),a=document.createElement("a"),i=URL.createObjectURL(n);a.href=i,a.download="".concat(t.name,".txt"),document.body.appendChild(a),a.click(),setTimeout(function(){document.body.removeChild(a),window.URL.revokeObjectURL(i)},0)}function ln(t){var e=t.body;return e+="\n".concat($rootVue.$t("sender_name"),": ").concat(t.name),e+="\n".concat($rootVue.$t("word_count"),": ").concat(t.body.length),e+="\n".concat($rootVue.$t("send_time"),": ").concat(A(t.created_at)),t.read_at&&(e+="\n".concat($rootVue.$t("read_time"),": ").concat(A(t.read_at))),e}function un(t){var e=t.preloadCount,n=void 0===e?5:e,a=t.dataList,i=void 0===a?[]:a;function s(){this.fastRender=!1,this.dataList=i,this.preloadCount=n}return s.prototype={optimise:function(){var t=this;this.fastRender=!0,setTimeout(function(){t.fastRender=!1},0)},renderedList:function(){return this.fastRender?this.dataList.slice(0,this.preloadCount):this.dataList}},new s}function dn(t){var e=document.querySelector("body");t?e.className?e.className.indexOf("night-mode")<0&&(e.className=e.className+" night-mode"):e.className="night-mode":e.className&&(e.className=e.className.replace(/\s?night-mode/,""))}var hn=null;function fn(t){if(hn)return hn[t];tt()({method:"get",url:"https://cdn.getslowly.com/i18n/countries/en.json"}).then(function(t){hn=t.data}).catch(function(t){hn={}})}var pn,mn,gn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.friendList,function(e){return n("div",{key:e.user_id,staticClass:"friend-item",class:{checked:e==t.checkedFriend},on:{click:function(n){return t.checkFriend(e)}}},[n("div",{staticClass:"header"},[n("img",{attrs:{src:t.getUserAvatar(e)}}),n("span",{directives:[{name:"show",rawName:"v-show",value:t.isExpand,expression:"isExpand"}],staticClass:"name"},[t._v(t._s(e.name))])])])}),0)},vn=[],_n={computed:Object(Ht["a"])({},Object(Wt["c"])(["checkedFriend","friendList"])),methods:Object(Ht["a"])({},Object(Wt["b"])(["checkFriend"]),{getUserAvatar:function(t){return"https://cdn.getslowly.com/assets/images/avatar/".concat(t.gender,"/").concat(t.avatar,".png")}}),props:{isExpand:!1}},wn=_n,bn=(n("014d"),n("2f2d"),Object(Bt["a"])(wn,gn,vn,!1,null,"3ece3ff7",null)),yn=bn.exports,Cn=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.checkedFriend?a("el-row",{staticClass:"component-wrapper"},[a("el-col",{staticClass:"left-section",attrs:{span:t.checkedLetter?12:24}},[a("div",{staticClass:"letter-list soft-scrollable"},t._l(t.renderLetters,function(e,i){return a("div",{key:e.id,staticClass:"letter-item",class:{"letter-checked":e==t.checkedLetter,"letter-highlight":t.highlightDate&&e.highlight},on:{click:function(n){return t.checkLetter(e,i)}}},[a("div",{staticClass:"letter-item-content"},[a("div",[t._v("\n            "+t._s(e.name)+"\n            "),a("span",{staticClass:"letter-state"},[t.isLetterArrive(e)?a("span",{staticClass:"letter-deliver-time"},[a("span",[t._v(t._s(t.formatReadableTime(e.created_at)))]),e.read_at?t._e():a("span",{staticClass:"letter-read-state"})]):a("img",{staticClass:"letter-in-out",attrs:{src:t.isLetterOut(e)?t.icLetterInOut[1]:t.icLetterInOut[0]}})])]),a("div",{staticClass:"letter-body"},[t.searchValue?a("span",{staticClass:"letter-content",domProps:{innerHTML:t._s(e.searchHtml)}}):a("span",{staticClass:"letter-content"},[t._v(t._s(e.body.substring(0,150)||t.getLeftTime(e)))]),a("img",{directives:[{name:"show",rawName:"v-show",value:e.attachments&&t.isLetterArrive(e),expression:"letter.attachments && isLetterArrive(letter)"}],staticClass:"letter-attacments",attrs:{src:n("1ec8")}})])])])}),0),a("div",{staticClass:"friend-info"},[a("div",{directives:[{name:"show",rawName:"v-show",value:!t.searchValue,expression:"!searchValue"}],staticClass:"friendinfo-header"},[a("div",{staticClass:"left-container"},[a("div",{staticClass:"content"},[a("span",{staticClass:"name",attrs:{title:t.checkedFriendInfo},on:{click:t.showFriendInfo}},[t._v(t._s(t.checkedFriend.name)),a("span",{attrs:{title:"信件数量"}},[t._v("("+t._s(t.searchValue?t.renderLetters.length:t.letters.length)+")")])]),a("i",{directives:[{name:"show",rawName:"v-show",value:t.checkedFriend.user_location,expression:"checkedFriend.user_location"}],staticClass:"el-icon-location",attrs:{title:t.$t("view_location")},on:{click:function(e){return t.$emit("showMap",t.checkedFriend)}}}),a("i",{staticClass:"el-icon-date",attrs:{title:t.$t("view_stat")},on:{click:function(e){t.showStat=!0}}}),a("i",{staticClass:"el-icon-plus",attrs:{title:t.$t("new_letter")},on:{click:t.newLetter}}),a("i",{staticClass:"el-icon-download",attrs:{title:t.$t("export_letters")},on:{click:t.doExport}})])]),a("div",{staticClass:"right-container"},[a("i",{directives:[{name:"show",rawName:"v-show",value:t.showSyncIcon,expression:"showSyncIcon"}],staticClass:"el-icon-loading"}),a("span",{directives:[{name:"show",rawName:"v-show",value:t.letterState,expression:"letterState"}],staticClass:"sync-state"},[t._v(t._s(t.letterState))]),a("i",{staticClass:"el-icon-close btn-close-letter",on:{click:t.closeLetters}})])]),a("span",{directives:[{name:"show",rawName:"v-show",value:t.searchValue,expression:"searchValue"}]},[a("span",{staticClass:"name"},[t._v(t._s(t.$t("search_placeholder_prefix"))+'"'+t._s(t.searchValue)+'"('+t._s(t.renderLetters.length)+")")])])])]),t.checkedLetter?a("el-col",{staticClass:"right-section",attrs:{span:12}},[t._e(),a("div",{staticClass:"scroll-container-wrapper"},[a("div",{staticClass:"scroll-container soft-scrollable"},[a("letter-item",{ref:"letterItem",attrs:{letter:t.checkedLetter}})],1),a("div",{staticClass:"letter-nav"},[a("span",{staticClass:"last-letter",style:{opacity:this.checkedLetterIndex>0?1:0},on:{click:t.lastLetter}},[t._v(t._s(t.$t("last_letter")))]),a("span",{staticClass:"next-letter",style:{opacity:this.checkedLetterIndex<this.renderLetters.length-1?1:0},on:{click:t.nextLetter}},[t._v(t._s(t.$t("next_letter")))]),a("i",{staticClass:"el-icon-close btn-close-letter",on:{click:function(e){t.checkedLetter=null}}})])])]):t._e(),a("new-letter",{ref:"newLetter",on:{sendSuccess:function(e){return t.loadLetters(t.checkedFriend)}}}),t.showStat?a("stat",{ref:"stat",attrs:{friend:t.checkedFriend},on:{close:function(e){t.showStat=!1},scrollToDate:function(e){return t.scrollToDate(e)}}}):t._e()],1):t._e()},kn=[],Ln=n("b1cc"),Sn=n.n(Ln),xn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.editorVisible?n("div",{staticClass:"modal"},[n("div",{staticClass:"editor-wrapper",class:{large:t.isShowLetter}},[n("div",{staticClass:"editor-header"},[n("span",[t._v("To "+t._s(t.checkedFriend&&t.checkedFriend.name))]),n("span",{directives:[{name:"show",rawName:"v-show",value:t.wordCount,expression:"wordCount"}],staticClass:"word-count"},[t._v(t._s(t.wordCount))]),n("span",{directives:[{name:"show",rawName:"v-show",value:t.letterState,expression:"letterState"}],staticClass:"sending-state"},[t._v(t._s(t.letterState))]),n("div",{staticClass:"right-btn-group"},[n("span",{staticClass:"el-icon-message",attrs:{title:t.$t("send")},on:{click:function(e){return t.send()}}}),n("span",{staticClass:"el-icon-tickets",attrs:{title:t.$t("history_letter")},on:{click:function(e){return t.toggleShowLetter()}}}),n("span",{staticClass:"el-icon-close",attrs:{title:t.$t("close")},on:{click:function(e){return t.close()}}})])]),n("el-row",{staticClass:"editor-content"},[n("el-col",{staticClass:"editor-left-section",attrs:{span:t.isShowLetter?12:24}},[n("div",{staticClass:"editor-body-wrapper"},[n("img",{staticClass:"stamp",attrs:{src:t._f("stampUrl")(t.stamp)},on:{click:function(e){t.showStampCollection=!0}}}),n("span",{directives:[{name:"show",rawName:"v-show",value:!t.inputData.length,expression:"!inputData.length"}],staticClass:"placeholder",on:{click:function(e){return t.$refs.editor.$el.focus()}}},[t._v(t._s(t.$t("write_words")))]),n("contenteditable",{ref:"editor",staticClass:"editor-body",attrs:{tag:"div",contenteditable:!0},model:{value:t.inputData,callback:function(e){t.inputData=e},expression:"inputData"}})],1),t.checkedFriend.share_photos?n("div",{staticClass:"form-section"},[n("form",{staticStyle:{width:"0",height:"0"},attrs:{id:"formSumbit",action:t.formUploadUrl(),method:"post",enctype:"multipart/form-data"}},[n("input",{staticStyle:{width:"0",height:"0"},attrs:{type:"file",id:"input-image",name:"image",multiple:"",accept:"image/png, image/jpeg"},on:{change:function(e){return t.onImageChange()}}})]),n("div",{staticClass:"tip-add-image",on:{click:function(e){t.isShowAddMedia=!t.isShowAddMedia}}},[t._v(t._s(t.$t("add_photos"))),n("span",{directives:[{name:"show",rawName:"v-show",value:t.rawImageList.length,expression:"rawImageList.length"}]},[t._v("("+t._s(t.rawImageList.length)+")")])]),!t.mobileMode||t.isShowAddMedia?n("div",{staticClass:"image-container"},[n("div",{staticClass:"btn-add-image",on:{click:function(e){return t.addImage()}}},[n("i",{staticClass:"el-icon-plus"})]),t._l(t.rawImageList,function(e,a){return n("div",{key:e.key,staticClass:"image-item"},[n("img",{attrs:{src:e.src},on:{click:function(n){return t.viewImage(e.src)}}}),n("i",{staticClass:"el-icon-remove",on:{click:function(e){return t.removeImage(a)}}})])})],2):t._e()]):t._e()]),t.isShowLetter&&t.checkedFriend.letters?n("el-col",{staticClass:"edit-letter-list soft-scrollable",attrs:{span:12}},t._l(t.renderLetters,function(t){return n("letter-item",{key:t.id,attrs:{dialogMode:!0,letter:t}})}),1):t._e()],1)],1),t.showStampCollection?n("stamps",{on:{select:t.onSelectStamp}}):t._e()],1):t._e()},In=[],An=n("5118"),Mn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.letter?n("div",{staticClass:"letter-detail-wrapper"},[n("div",{staticClass:"letter-detail",class:{"dialog-mode":t.dialogMode}},[n("img",{staticClass:"stamp",attrs:{src:t._f("stampUrl")(this.letter.stamp),alt:"Stamp"}}),n("div",{domProps:{innerHTML:t._s(t.highlightBody(t.letter))}}),t.attachments?n("div",{staticClass:"attachments"},[t.zoomInImage?n("div",{staticClass:"zoom-in"},t._l(t.attachments,function(e){return n("div",{key:e,staticClass:"image-wrapper",on:{click:function(e){t.zoomInImage=!t.zoomInImage}}},[n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e,expression:"url"}]}),n("a",{attrs:{href:e,target:"_blank"}})])}),0):n("grid-view",{attrs:{numColumns:t.attachments.length>2?3:2,spaceX:10,spaceY:10}},t._l(t.attachments,function(e){return n("img",{directives:[{name:"lazy",rawName:"v-lazy",value:e,expression:"url"}],key:e,on:{click:function(e){t.zoomInImage=!t.zoomInImage}}})}),0)],1):t._e()]),n("div",{staticClass:"letter-info-wrapper"},[n("div",{staticClass:"letter-info"},[n("div",{staticClass:"key"},t._l(t.letterInfos[0],function(e){return n("span",{key:e},[t._v("\n          "+t._s(e)+"\n        ")])}),0),n("div",{staticClass:"value"},t._l(t.letterInfos[1],function(e,a){return n("span",{key:e+a},[t._v("\n          "+t._s(e)+"\n        ")])}),0)])])]):t._e()},On=[],$n=n("db0c"),Fn=n.n($n),En=n("4aa6"),jn=n.n(En),Dn=(n("c5f6"),{render:function(t){var e=this,n=(this.$slots.default&&this.$slots.default.filter(function(t){return null!=t.tag})||[]).map(function(n,a){return n.data.class||(n.data.class=""),n.data.class+=" grid-child",t("div",{style:{width:"calc(".concat(100/e.numColumns,"% - ").concat(e.spaceX*(e.numColumns-1)/e.numColumns,"px"),marginTop:a<e.numColumns?0:"".concat(e.spaceY,"px"),marginLeft:a%e.numColumns?"".concat(e.spaceX,"px"):0}},[t("div",{class:"grid-child-box",style:{paddingTop:e.getChildHeight()}},[n])])});return t("div",{class:"grid-view"},n)},props:{numColumns:{type:Number,default:3},spaceX:{type:Number,default:0},spaceY:{type:Number,default:0},getChildHeight:{type:Function,default:function(){return"100%"}}}}),Tn=Dn,Nn=(n("7541"),Object(Bt["a"])(Tn,pn,mn,!1,null,"9e813d44",null)),Vn=Nn.exports,Rn=(n("b60b"),{components:{GridView:Vn},data:function(){return{zoomInImage:!1}},props:{letter:{type:Object,required:!0},dialogMode:{type:Boolean,default:function(){return!1}}},watch:{letter:function(){this.zoomInImage=!1}},computed:Object(Ht["a"])({},Object(Wt["c"])(["checkedFriend","searchValue"]),{attachments:function(){var t=this.letter;return t&&t.attachments?t.attachments.split(",").map(function(t){return At(t)}):null},letterInfos:function(){var t=jn()(null);return t[this.$t("word_count")]=R(this.letter.body),t[this.$t("sender_name")]=this.letter.name,t[this.$t("send_time")]=this.formatTime(this.letter.created_at),t[this.$t("arrive_time")]=this.formatTime(this.letter.deliver_at),this.letter.read_at&&(t[this.$t("read_time")]=this.formatTime(this.letter.read_at)),[Z()(t),Fn()(t)]}}),methods:{formatTime:function(t){return A(t)},highlightBody:function(t){var e=t.body&&t.body.trim()||"";return this.searchValue?e.split(this.searchValue).join('<span class="highlight">'+this.searchValue+"</span>"):e}}}),Pn=Rn,qn=(n("02b3"),n("350d"),Object(Bt["a"])(Pn,Mn,On,!1,null,"484db498",null)),Bn=qn.exports,Qn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"modal soft-scrollable"},[n("div",{staticClass:"close-wrapper"},[n("i",{staticClass:"el-icon-close btn-close-stamps",on:{click:function(e){return t.selectStamp()}}})]),n("div",{staticClass:"content"},t._l(t.stamps,function(e){return n("div",{key:e.slug,staticClass:"stamp-wrapper",on:{click:function(n){return t.selectStamp(e.item_slug)}}},[n("img",{staticClass:"stamp",attrs:{src:t._f("stampUrl")(e.item_slug)}}),n("div",{staticClass:"stamp-desc"},[t._v(t._s(e.item_name))])])}),0)])},Un=[],Gn={data:function(){return{stamps:st().items||[]}},methods:{selectStamp:function(t){this.$emit("select",t)}}},zn=Gn,Hn=(n("77d1"),Object(Bt["a"])(zn,Qn,Un,!1,null,"2bf45384",null)),Wn=Hn.exports,Yn="local",Xn="server",Jn={data:function(){return{editorVisible:!1,inputData:"",isSending:!1,isUploading:!1,isLoadingDraft:!1,isShowLetter:!1,rawImageList:[],isAutoSaving:!1,listRender:un({preloadCount:5}),isShowAddMedia:!1,stamp:"free",showStampCollection:!1,draft:null}},components:{LetterItem:Bn,GridView:Vn,Stamps:Wn},computed:Object(Ht["a"])({},Object(Wt["c"])(["checkedFriend","mobileMode"]),{renderLetters:function(){return this.listRender.renderedList()},letterState:function(){return this.isSending||this.isUploading||this.isAutoSaving||this.isLoadingDraft?this.isLoadingDraft?this.$t("loading_draft"):this.isUploading?this.$t("uploading_photo"):this.isSending?this.$t("sending"):this.$t("saving_draft"):""},wordCount:function(){return R(this.inputData)}}),watch:{editorVisible:function(t){t?(this.listRender.optimise(),this.scrollLetterListToTop()):this.intervalId&&(Object(An["clearInterval"])(this.intervalId),this.intervalId=null)},checkedFriend:function(t){t&&(this.listRender.dataList=t.letters||[])},inputData:function(t){this.contentHasChanged=!0}},methods:{formUploadUrl:function(){return Mt(this.checkedFriend.id)},showEditor:function(){var t=this;this.editorVisible=!0,this.inputData="",this.isSending=!1,this.isUploading=!1,this.isLoadingDraft=!1,this.rawImageList=[],this.draft=null,this.loadDraft(),this.intervalId=Object(An["setInterval"])(function(){t.contentHasChanged&&t.draft&&(t.saveDraft(),t.contentHasChanged=!1)},6e4)},loadDraft:function(){var t=this;this.isLoadingDraft=!0,Tt(this.checkedFriend.id).then(function(e){var n=e.data.draft;t.draft=n,n&&(n.body&&(t.inputData=n.body),t.stamp=n.stamp,n.attachments&&n.attachments.split(",").map(function(t){return{type:Xn,src:At(t),imageName:t}}).forEach(function(e){return t.rawImageList.push(e)}))}).catch(function(e){console.error(e),t.$confirm(t.$t("warn_fail_to_load_draft"),t.$t("tip"),{confirmButtonText:t.$t("confirm"),cancelButtonText:t.$t("cancel")}).then(function(){t.loadDraft()}).catch(function(){})}).then(function(){t.isLoadingDraft=!1})},onSelectStamp:function(t){t&&(this.stamp=t),this.showStampCollection=!1},close:function(){var t=this;this.inputData?this.$confirm(this.$t("warn_close_new_letter"),this.$t("tip"),{confirmButtonText:this.$t("confirm"),cancelButtonText:this.$t("cancel")}).then(function(){t.uploadImages().then(function(e){return t.saveDraft(e)}).then(function(){return t.editorVisible=!1}).catch(function(e){x(t,e)})}):this.editorVisible=!1},saveDraft:function(t){var e=this;return this.isAutoSaving=!0,Nt({friendId:this.checkedFriend.id,body:this.inputData,stamp:this.stamp,attachments:null==t?this.draft&&this.draft.attachments:t}).then(function(t){e.isAutoSaving=!1}).catch(function(t){return console.error(t),e.isAutoSaving=!1,W.a.reject("Failed to save draft")})},clearDraft:function(){var t=this;return this.isAutoSaving=!0,Nt({friendId:this.checkedFriend.id,body:"",stamp:this.stamp,attachments:""}).then(function(e){t.isAutoSaving=!1}).catch(function(e){console.error(e),t.isAutoSaving=!1})},send:function(){var t=this;this.inputData?this.$confirm(this.$t("warn_is_sending_to",{friend:this.checkedFriend.name}),this.$t("tip"),{confirmButtonText:this.$t("confirm"),cancelButtonText:this.$t("cancel")}).then(function(){t.uploadImages().then(function(e){return t.sendImpl(e)}).catch(function(e){x(t,e)})}).catch(function(){}):x(this,this.$t("input_content"))},formatContent:function(t){return t?t.replace(/\n\n\n/g,"\n\n"):t},sendImpl:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.isSending=!0;var n=st();St({id:this.checkedFriend.id,letter:this.formatContent(this.inputData),isHost:this.checkedFriend.joined!=n.id,attachments:e,stamp:this.stamp}).then(function(e){return t.checkedFriend.lastRefreshTime=0,t.$emit("sendSuccess"),t.clearDraft()}).then(function(){t.isSending=!1,t.editorVisible=!1,I(t,"success")}).catch(function(e){var n=e.message;t.isSending=!1,x(t,n)})},toggleShowLetter:function(){this.isShowLetter=!this.isShowLetter,this.isShowLetter&&this.checkedFriend&&(this.listRender.dataList=this.checkedFriend.letters||[]),this.listRender.optimise(),this.scrollLetterListToTop()},scrollLetterListToTop:function(){this.isShowLetter&&rn(this,".edit-letter-list")},addImage:function(){this.$el.querySelector("#input-image").click()},onImageChange:function(){for(var t=this.$el.querySelector("#input-image").files||[],e=0;e<t.length;e++)this.loadImage(t[e])},loadImage:function(t){var e=this,n=new FileReader;n.onload=function(n){e.rawImageList.push({src:n.target.result,file:t,key:e.generateImageKey(),type:Yn})},n.readAsDataURL(t)},generateImageKey:function(){return null==this.imageKey&&(this.imageKey=0),this.imageKey++},removeImage:function(t){this.rawImageList.splice(t,1)},uploadImages:function(){var t=this,e=this.rawImageList.filter(function(t){return t.type===Yn}),n=this.rawImageList.filter(function(t){return t.type===Xn});return 0===e.length?W.a.resolve(n.map(function(t){return t.imageName}).join(",")):(this.isUploading=!0,Ot(this.checkedFriend.id,e.map(function(t){return t.file})).then(function(e){t.isUploading=!1;var a=n.map(function(t){return t.imageName}).concat(e.map(function(t){return t.data}));return a.join(",")}).catch(function(e){return t.isUploading=!1,console.error(e),W.a.reject("Failed to upload images")}))},viewImage:function(t){window.open().document.write('<iframe src="'+t+'" frameborder="0" style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;" allowfullscreen></iframe>')}}},Zn=Jn,Kn=(n("8fc6"),n("f642"),Object(Bt["a"])(Zn,xn,In,!1,null,"54c18af2",null)),ta=Kn.exports,ea=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.stat?n("div",{staticClass:"modal"},[n("div",{staticClass:"stat-info-content"},[n("div",{staticClass:"stat-header"},[n("span",[t._v(t._s(t.stat.name))]),n("span",{staticClass:"el-icon-close",attrs:{title:t.$t("close")},on:{click:function(e){return t.close()}}})]),n("div",{staticClass:"stat-content"},[n("div",{staticClass:"stat-detail"},t._l(t.statList,function(e){return n("div",{key:e},[t._v("\n          "+t._s(e)+"\n        ")])}),0),n("div",{staticClass:"date-map-section"},[n("div",{staticClass:"svg-info",class:{latin:"en"===t.$i18n.locale}},[n("span",{staticClass:"from"},[t._v(t._s(t.$t("stat_from")))]),n("span",{staticClass:"to"},[t._v(t._s(t.$t("stat_to")))])]),n("span",{staticClass:"hover-text",class:{hide:t.hideDateStr,link:t.isMobile},on:{click:function(e){return t.scrollToLetter(t.lastSelectedDate)}}},[t._v(t._s(t.hoverDateStr))]),n("div",{attrs:{id:"svg-container"}})])])])]):t._e()},na=[],aa=n("1929"),ia=n.n(aa),sa=["#C6E2FF","#3296FC","#036CD9"],ra=["#C9ECB4","#86D666","#11AE2B"];function oa(t){return t-1>2?2:t-1}function ca(t){var e=t.id,n=t.isLatin,a=t.dataList,i=t.monthList,s=t.weekList,r=t.onHover,o=t.onClick,c=t.nightMode,l=n?35:26,u=48,d=16,h=da(a),f=300;if(h.length>1){var p=h[0].date,m=h[h.length-1].date,g=F(p,m);f=(g/7+3)*d+l}var v=ia()(e).size(f,168),_=new Date,w=ua(_),b=6,y=0,C=new Date(h[0].date.valueOf()),k=0,L=-1,S=-1;while(k<h.length){var x=h[k],I=x.date,A=ua(I),M=$(C),O=ua(C),E=O-A,j=[c?"#222222":"#F7F7F7"],D=!1;if(0==E)(0!=k||x.num>0)&&(j=x.fromNum>0&&x.toNum>0?[sa[oa(x.fromNum)],ra[oa(x.toNum)]]:x.fromNum>0?[sa[oa(x.fromNum)]]:[ra[oa(x.toNum)]]),D=!0,k++;else if(E<0){console.log("order is wrong");break}var T=l+y*d,N=u+b*d,V=v.group().transform({x:T,y:N});if(1==j.length){var R=v.rect(d-2,d-2).attr({fill:j[0]}).radius(4);V.add(R),w==O&&V.add(v.rect(d,d).attr({fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0.70)",x:-1,y:-1}).radius(4))}else{var P=v.path("M0 7 V4 Q0 0 4 0 H10 Q14 0 14 4 V7 Z").attr({fill:j[0],"stroke-width":0}),q=v.path("M0 7 V10 Q0 14 4 14 H10 Q14 14 14 10 V7 Z").attr({fill:j[1],"stroke-width":0}),B=v.rect(d-2,d-2).attr({fill:"rgba(0,0,0,0)"}).radius(4);V.add(P),V.add(q),V.add(B),w==O&&V.add(v.rect(d,d).attr({fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0.70)",x:-1,y:-1}).radius(4))}V.dateStr=M,V.fromNum=D?x.fromNum:0,V.toNum=D?x.toNum:0,V.mouseover(function(){r&&r(this.dateStr,this.fromNum,this.toNum),this.stroke({color:"rgba(0,0,0,0.3)"})}),V.mouseout(function(){r&&r(""),this.stroke({color:"rgba(0,0,0,0)"})}),V.click(function(){o&&o(this.dateStr,this.fromNum,this.toNum)}),(L<0||L!=C.getFullYear())&&v.text(function(t){t.tspan("".concat(C.getFullYear())).dy(0)}).font({fill:_.getFullYear()==C.getFullYear()?"rgba(0,0,0, 0.9)":"#ccc",size:15}).attr("x",T).attr("y",10).attr("dominant-baseline","hanging"),L=C.getFullYear(),(S<0||S!=C.getMonth())&&100*C.getFullYear()+C.getMonth()<=100*_.getFullYear()+_.getMonth()&&v.text(function(t){t.tspan(i[C.getMonth()]).dy(0)}).font({fill:_.getMonth()==C.getMonth()&&_.getFullYear()==C.getFullYear()?"rgba(0,0,0, 0.9)":"#ccc",size:11}).attr("x",T).attr("y",31).attr("dominant-baseline","hanging"),S=C.getMonth(),C.setDate(C.getDate()-1),b--,-1==b&&(b=6,y++)}return s.forEach(function(t,e){v.text(t).font({fill:"rgba(0,0,0,0.25)",size:11}).attr("x",8).attr("y",43+32*e)}),function(){r=null,o=null,v.node&&[].concat(Object(Ue["a"])(v.node.children),[v.node]).map(function(t){t.instance=null,t.remove()})}}function la(t,e){return ua(t)-ua(e)}function ua(t){return 1e4*t.getFullYear()+100*t.getMonth()+t.getDate()}function da(t){var e=st();t.sort(function(t,e){return e.deliver_at?e.deliver_at.localeCompare(t.deliver_at):1});for(var n,a,i=[],s=0;s<t.length;s++){var r=t[s];if(r.deliver_at){var o=M(V(r.deliver_at)),c=r.user!=e.id;n&&0==la(n,o)?(a.num++,c?a.fromNum++:a.toNum++):(a={date:o,num:1,fromNum:c?1:0,toNum:c?0:1},i.push(a)),n=o}}var l=ha();return i.splice(0,0,{date:l,num:0}),i}function ha(){var t=new Date,e=new Date(t.getFullYear(),t.getMonth()+1,0),n=e.getDay(),a=6-n;return e.addDays(a)}var fa={props:{friend:{type:Object,required:!0}},data:function(){return{cellDataList:[],stat:null,account:st(),hoverDateStr:"",hideDateStr:!1,lastSelectedDate:null,isMobile:P()}},computed:Object(Ht["a"])({},Object(Wt["c"])(["nightMode"]),{statList:function(){var t=[this.$t("stat_line1",{date:this.stat.firstLetter.dateStr,fromUser:this.stat.firstLetter.from,toUser:this.stat.firstLetter.to}),this.$t("stat_line2",{dayCount:this.stat.totalDays}),this.$t("stat_line3",{letterCount:this.stat.totalCount,wordCount:this.stat.totalWordCount}),this.$t("stat_line4",{friend:this.stat.name,letterCount:this.stat.totalToCount,wordCount:this.stat.totalToWordCount}),this.$t("stat_line5",{friend:this.stat.name,letterCount:this.stat.totalFromCount,wordCount:this.stat.totalFromWordCount})];return this.stat.perday.count>2&&t.push(this.$t("stat_line6",{date:this.stat.perday.dateStr,letterCount:this.stat.perday.count})),this.stat.sinLastDays>1&&t.push(this.$t("stat_line7",{dayCount:this.stat.sinLastDays})),t}}),methods:{close:function(){this.$emit("close")},showStat:function(){var t=this;this.$nextTick(function(){t.destroySvg=ca({id:"svg-container",nightMode:t.nightMode,isLatin:"en"===t.$i18n.locale,monthList:t.$t("stat_month_list").split(","),weekList:t.$t("stat_week_list").split(","),dataList:t.friend.letters,onHover:function(e,n,a){e?(Object(An["clearTimeout"])(t.dateTimeoutId),t.showSelectedDate(e,n,a)):t.dateTimeoutId=Object(An["setTimeout"])(function(){t.hideDateStr=!0,t.dateTimeoutId=Object(An["setTimeout"])(function(){t.hoverDateStr=""},300)},500)},onClick:function(e,n,a){t.isMobile?(t.lastSelectedDate=e,t.showSelectedDate(e,n,a)):t.scrollToLetter(e)}})})},showSelectedDate:function(t,e,n){this.hideDateStr=!1,this.hoverDateStr=this.$t("stat_hover_date_str",{date:t,fromCount:e||0,toCount:n||0})},scrollToLetter:function(t){t&&(this.close(),this.$emit("scrollToDate",t))},calculateStat:function(t){for(var e=t.letters||[],n={name:t.name,firstLetter:{},lastLetter:{},totalDays:0,perday:{count:0,dateStr:""},totalCount:0,totalWordCount:0,totalFromCount:0,totalFromWordCount:0,totalToCount:0,totalToWordCount:0},a={},i=0;i<e.length;i++){var s=e[i],r=s.user==this.account.id,o=R(s.body);n.totalCount++,n.totalWordCount+=o,r?(n.totalToCount++,n.totalToWordCount+=o):(n.totalFromCount++,n.totalFromWordCount+=o);var c=M(V(s.deliver_at)),l=O(c),u=l.substring(0,10);i==e.length-1&&(n.firstLetter.dateStr=u,n.firstLetter.date=c,r?(n.firstLetter.from=this.$t("you"),n.firstLetter.to=t.name):(n.firstLetter.from=t.name,n.firstLetter.to=this.$t("you"))),0==i&&(n.lastLetter.date=c),null==a.dateStr?(a.dateStr=u,a.count=1):a.dateStr==u?a.count++:((!n.perday.dateStr||a.count>n.perday.count)&&(n.perday.dateStr=a.dateStr,n.perday.count=a.count),a.dateStr=u,a.count=1)}return n.totalDays=F(new Date,n.firstLetter.date),n.sinLastDays=F(new Date,n.lastLetter.date),n}},beforeDestroy:function(){this.destroySvg&&this.destroySvg()},mounted:function(){this.stat=this.calculateStat(this.friend),this.showStat()}},pa=fa,ma=(n("d76f"),Object(Bt["a"])(pa,ea,na,!1,null,"4d195276",null)),ga=ma.exports,va=n("9087"),_a=n.n(va),wa=n("e380"),ba=n.n(wa),ya={components:{NewLetter:ta,Stat:ga,LetterItem:Bn},computed:Object(Ht["a"])({},Object(Wt["c"])(["checkedFriend","searchValue"]),{attachments:function(){var t=this.checkedLetter;return t&&t.attachments?t.attachments.split(",").map(function(t){return At(t)}):null},icLetterInOut:function(){return[ba.a,_a.a]},renderLetters:function(){var t=this,e=this.listRender.renderedList(),n=new RegExp(this.searchValue,"g"),a=this.searchValue?e.filter(function(e){var a=Object(Ue["a"])(Sn()(e.body,n));if(0==a.length)return!1;for(var i="",s=-1,r=Math.min(a.length,5),o=0;o<r;o++){var c=6,l=a[o],u=s+1;l.index-u>c&&(i+="...",u=l.index-c),i+=e.body.substr(u,l.index-u)+t.searchValue;var d=l.index+t.searchValue.length+c;if(r-1>o){var h=a[o+1];d=Math.min(h.index-1,d)}i+=e.body.substring(l.index+t.searchValue.length,d+1),s=d,r-1==o&&i.length<150&&(i+=e.body.substr(s,150-i.length))}return e.searchHtml=i.split(t.searchValue).join('<span style="color: red">'+t.searchValue+"</span>"),!0}):e,i=this.searchValue;if(this.checkedLetter){for(var s=-1,r=0;r<a.length;r++)if(a[r].id==this.checkedLetter.id){s=r;break}s<0?this.checkedLetter=null:i!=this.lastSearchText&&this.$nextTick(function(){t.scorllToIndex(s)})}return this.lastSearchText=i,a},checkedFriendInfo:function(){if(this.checkedFriend){var t=[];t.push([this.$t("name"),this.checkedFriend.name]);var e=this.checkedFriend.location_code,n=fn(e);return n&&t.push([this.$t("location"),n]),this.checkedFriend.latest_comment&&t.push([this.$t("reply_time"),A(this.checkedFriend.latest_comment)]),this.checkedFriend.last_login&&t.push([this.$t("login_time"),A(this.checkedFriend.last_login)]),t.map(function(t){return t.join("：")}).join("\n")}return""},searchNav:function(){return this.checkedFriend&&this.searchValue&&this.refs.letterItem?{show:!0}:{show:!1}}}),watch:{checkedFriend:function(t,e){!t||t&&e&&t.id==e.id||(this.letters=[],this.loadLetters(t),this.checkedLetter=null,rn(this,".letter-list"))}},data:function(){return{letters:[],mapVisible:!1,map:null,letterState:"",showSyncIcon:!1,checkedLetter:null,checkedLetterIndex:-1,account:st(),highlightDate:null,listRender:un({preloadCount:25}),showStat:!1}},methods:Object(Ht["a"])({},Object(Wt["b"])(["checkFriend"]),{showFriendInfo:function(){this.$message({dangerouslyUseHTMLString:!0,message:this.checkedFriendInfo,duration:1e4,showClose:!0,customClass:"dialog-friend-info"})},loadLetters:function(t){var e=this;en(t).setCallback(function(t,n){var a=n.isRefresh,i=n.isSync,s=n.dataList,r=n.isSuccess;if(t.userId==e.checkedFriend.id&&(i?(e.showSyncIcon=!1,e.letterState=e.$t("tip_sync_page",{pageIndex:t.syncPage})):a?(e.letterState=null,e.showSyncIcon=!0):(e.showSyncIcon=!1,e.letterState=null,r||x(e,e.$t("err_sync_fail"))),0==e.letters.length&&e.listRender.optimise(),e.letters=s,e.listRender.dataList=e.letters,e.checkedFriend.letters=s,e.checkedLetter))for(var o=0;o<s.length;o++)if(s[o].id==e.checkedLetter.id){e.checkLetter(s[o],o,!0);break}}).requestData()},newLetter:function(){this.$refs.newLetter.showEditor()},checkLetter:function(t,e,n){var a=this;e<0||e>=this.renderLetters.length||(this.checkedLetter=t,this.checkedLetterIndex=e,n||rn(this,".right-section .scroll-container"),t.read_at||this.isLetterOut(t)||!this.isLetterArrive(t)||Ft(t.id).then(function(e){if(e&&e.data.success){var n=O(M(new Date,!0));a.$set(t,"read_at",n),an(a.checkedFriend,t)}}).catch(function(t){a.$errorHandler(t),console.error(t)}))},formatReadableTime:function(t){return j(M(t))},isLetterArrive:function(t){return M(t.deliver_at)<U()()},getLeftTime:function(t){var e=M(t.deliver_at)-U()();if(e>0){var n=e/6e4;if(n<30)return this.$tc("arrive_in_minutes",z()(n));var a=n/60;return this.$tc("arrive_in_hours",z()(a)+1)}return""},isLetterOut:function(t){return t.user==this.account.id},lastLetter:function(){this.checkLetter(this.renderLetters[this.checkedLetterIndex-1],this.checkedLetterIndex-1)},nextLetter:function(){this.checkLetter(this.renderLetters[this.checkedLetterIndex+1],this.checkedLetterIndex+1)},scrollToDate:function(t){var e=this,n=-1,a=!1;this.renderLetters.forEach(function(e){var i=$(M(e.deliver_at));a||(i==t&&(a=!0),n++),e.highlight=i==t}),this.highlightDate=t;var i=this.$el.querySelector(".letter-list");a&&this.scorllToIndex(n),on(i,function(){setTimeout(function(){e.highlightDate=null},2e3)})},scorllToIndex:function(t,e){e||(e=this.$el.querySelector(".letter-list")),e&&e.children&&e.children.length>t&&(e.scrollTop=e.children[t].offsetTop)},closeLetters:function(){this.checkFriend(null)},doExport:function(){cn(this.checkedFriend,this.letters)}})},Ca=ya,ka=(n("8a9c"),n("e266"),Object(Bt["a"])(Ca,Cn,kn,!1,null,"16467654",null)),La=ka.exports,Sa=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"input-container"},[n("input",{directives:[{name:"model",rawName:"v-model",value:t.content,expression:"content"}],ref:"input",class:{"has-content":t.content},attrs:{spellcheck:"false"},domProps:{value:t.content},on:{focus:function(e){t.inputFocus=!0},blur:function(e){t.inputFocus=!1},input:function(e){e.target.composing||(t.content=e.target.value)}}}),!t.checkedFriend||t.content||t.inputFocus?t._e():n("span",{staticClass:"placeholder"},[t._v("\n    "+t._s(t.$t("search_placeholder_prefix"))),n("span",{staticClass:"name"},[t._v(t._s(t.checkedFriend.name))]),t._v(t._s(t.$t("search_placeholder_suffix"))+"\n  ")]),n("i",{staticClass:"el-icon-search"}),n("i",{directives:[{name:"show",rawName:"v-show",value:t.searchValue,expression:"searchValue"}],staticClass:"el-icon-close",on:{click:t.clear}})])},xa=[],Ia={data:function(){return{content:"",inputFocus:!1}},computed:Object(Ht["a"])({},Object(Wt["c"])(["searchValue","checkedFriend"])),watch:{content:function(t){this.setSearchValue(t)}},methods:Object(Ht["a"])({},Object(Wt["b"])(["setSearchValue"]),{clear:function(){this.content=""}})},Aa=Ia,Ma=(n("7787"),Object(Bt["a"])(Aa,Sa,xa,!1,null,"b6519c64",null)),Oa=Ma.exports,$a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"no-scroll-bar"},[n("div",{directives:[{name:"longpress",rawName:"v-longpress",value:t.handlongPress,expression:"handlongPress"}],staticClass:"quote-section"},[t.currentQuote?n("div",{staticClass:"quote-item"},[n("div",{staticClass:"content"},[t._v(t._s(t.currentQuote.content))]),n("div",{staticClass:"author"},[t._v(t._s(t.currentQuote.quoteInfo))])]):t._e()])])},Fa=[],Ea={en:{file:"quotes-en.json",version:1},default:{file:"quotes.json",version:1}},ja={data:function(){return{quotes:[],currentQuote:null,eventConsumed:!1,times:0}},computed:{},methods:{getQuoteInfo:function(t){var e=t.ref_name||t.au_name,n=t.ref_name?t.au_name:"";return e?"——".concat(e).concat(n?" · ":"").concat(n):""},changeQuote:function(){if(0!==this.quotes.length){var t=this.quotes[z()(Math.random()*this.quotes.length)];this.currentQuote={content:t.content,quoteInfo:this.getQuoteInfo(t)}}},handlongPress:function(t){if(t)this.changeQuote();else if(this.currentQuote){var e=this.currentQuote.content+this.currentQuote.quoteInfo;T(e),I(this,this.$t("tip_copy_quote"))}},fetchQuotes:function(){var t=this,e=Ea[this.$i18n.locale]||Ea.default;tt()({method:"get",url:"./".concat(e.file,"?v=").concat(e.version)}).then(function(e){e.data&&e.data.length>0&&(t.quotes=e.data,t.changeQuote())}).catch(function(t){console.error(t)})}},mounted:function(){var t=this;this.fetchQuotes(),this.$watch("$i18n.locale",function(e,n){("en"===e&&"en"!==n||"en"===n&&"en"!==e)&&t.fetchQuotes()})}},Da=ja,Ta=(n("84ed"),Object(Bt["a"])(Da,$a,Fa,!1,null,"341a9ad8",null)),Na=Ta.exports,Va=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.mapVisible?n("div",{staticClass:"modal"},[t._m(0),n("el-button",{staticClass:"btn-close",attrs:{type:"primary",icon:"el-icon-close",circle:"",title:t.$t("close_map")},on:{click:function(e){t.mapVisible=!1}}}),n("el-button",{staticClass:"btn-update-location",attrs:{type:"primary",icon:"el-icon-edit",title:t.$t("update_location"),circle:""},on:{click:t.updateToSelectLocation}}),t._e()],1):t._e()},Ra=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"map-wrapper"},[n("div",{attrs:{id:"map"}})])}],Pa=n("59ad"),qa=n.n(Pa),Ba=function(){function t(){}return t.wgs2gcj=function(e,n){if(t.outOfChina(e,n))return[e,n];var a=t.delta(e,n);return[e+a[0],n+a[1]]},t.wgs2bd=function(e,n){if(t.outOfChina(e,n))return[e,n];var a=t.wgs2gcj(e,n),i=t.gcj2bd(a[0],a[1]);return i},t.gcj2wgs=function(e,n){if(t.outOfChina(e,n))return[e,n];var a=t.delta(e,n);return[e-a[0],n-a[1]]},t.gcj2bd=function(e,n){var a=Math.sqrt(n*n+e*e)+2e-5*Math.sin(e*t.x_pi),i=Math.atan2(e,n)+3e-6*Math.cos(n*t.x_pi),s=a*Math.cos(i)+.0065,r=a*Math.sin(i)+.006;return[r,s]},t.bd2wgs=function(e,n){var a=t.bd2gcj(e,n),i=t.gcj2wgs(a[0],a[1]);return i},t.bd2gcj=function(e,n){var a=n-.0065,i=e-.006,s=Math.sqrt(a*a+i*i)-2e-5*Math.sin(i*t.x_pi),r=Math.atan2(i,a)-3e-6*Math.cos(a*t.x_pi),o=s*Math.cos(r),c=s*Math.sin(r);return[c,o]},t.distance=function(t,e,n,a){var i=6371e3,s=Math.cos(3.141592653589793*t/180)*Math.cos(3.141592653589793*n/180)*Math.cos(3.141592653589793*(e-a)/180),r=Math.sin(3.141592653589793*t/180)*Math.sin(3.141592653589793*n/180),o=s+r;o>1&&(o=1),o<-1&&(o=-1);var c=Math.acos(o),l=c*i;return l},t.outOfChina=function(t,e){return!(e>=72.004&&e<=137.8347)||(t<.8293||t>55.8271)},t.delta=function(e,n){var a=6378245,i=.006693421622965943,s=t.transformLat(n-105,e-35),r=t.transformLon(n-105,e-35),o=e/180*t.pi,c=Math.sin(o);c=1-i*c*c;var l=Math.sqrt(c);return s=180*s/(a*(1-i)/(c*l)*t.pi),r=180*r/(a/l*Math.cos(o)*t.pi),[s,r]},t.transformLat=function(e,n){var a=2*e-100+3*n+.2*n*n+.1*e*n+.2*Math.sqrt(Math.abs(e));return a+=2*(20*Math.sin(6*e*t.pi)+20*Math.sin(2*e*t.pi))/3,a+=2*(20*Math.sin(n*t.pi)+40*Math.sin(n/3*t.pi))/3,a+=2*(160*Math.sin(n/12*t.pi)+320*Math.sin(n*t.pi/30))/3,a},t.transformLon=function(e,n){var a=300+e+2*n+.1*e*e+.1*e*n+.1*Math.sqrt(Math.abs(e));return a+=2*(20*Math.sin(6*e*t.pi)+20*Math.sin(2*e*t.pi))/3,a+=2*(20*Math.sin(e*t.pi)+40*Math.sin(e/3*t.pi))/3,a+=2*(150*Math.sin(e/12*t.pi)+300*Math.sin(e/30*t.pi))/3,a},t.mercator2LatLon=function(t,e){var n=t/20037508.34*180,a=e/20037508.34*180;a=57.29577951308232*(2*Math.atan(Math.exp(3.141592653589793*a/180))-1.5707963267948966);var i=[a,n];return i},t.latLon2Mercator=function(t,e){var n=20037508.34*e/180,a=Math.log(Math.tan(3.141592653589793*(90+t)/360))/.017453292519943295;return a=20037508.34*a/180,[n,a]},t}();function Qa(t,e){return Ba.bd2wgs(t,e)}function Ua(t,e){return Ba.wgs2bd(t,e)}Ba.pi=3.141592653589793,Ba.a=6378245,Ba.ee=.006693421622965943,Ba.x_pi=52.35987755982988,Ba["__class"]="LocationUtil";var Ga={data:function(){return{map:null,mapVisible:!1}},methods:{editLocation:function(){st()?st().location?this.showGpsLocationStr(st().location):(x(this,this.$t("err_location_not_exist")),this.showGpsLocation(0,0)):x(this,this.$t("err_account_not_exist"))},onMapClick:function(t){this.removeOverlays(),this.addMarker(t.point,!1)},showMap:function(t){this.showGpsLocationStr(t.user_location)},parseLocationStr:function(t){var e=t.split(",");return{lat:qa()(e[0]),lng:qa()(e[1])}},showGpsLocationStr:function(t){this.showGpsLocationList([this.parseLocationStr(t)])},showGpsLocation:function(t,e){this.showGpsLocationList([{lat:t,lng:e}])},showGpsLocationList:function(t){var e=this;this.initMap().then(function(){e.removeOverlays(),t.forEach(function(t){var n=Ua(t.lat,t.lng);e.addMarker(new BMap.Point(n[1],n[0]),!0)})})},initMap:function(){var t=this;return this.mapVisible=!0,new W.a(function(e){t.$nextTick(function(){t.map=new BMap.Map("map"),t.map.enableScrollWheelZoom(!0),t.map.addEventListener("click",function(e){t.onMapClick(e)}),e(t.map)})})},addMarker:function(t,e){var n=this,a=new BMap.Marker(t);a.slowly=!0,this.map.addOverlay(a),e&&(this.map.centerAndZoom(t,15),window.setTimeout(function(){n.map.panTo(t)},100))},removeOverlays:function(){for(var t=this.map.getOverlays(),e=t.length-1;e>=0;e--)this.map.removeOverlay(t[e])},updateToSelectLocation:function(){for(var t=this,e=this.map.getOverlays(),n=null,a=e.length-1;a>=0;a--)if(e[a].slowly){n=e[a];break}if(n){var i=Qa(n.point.lat,n.point.lng);this.$confirm(this.$t("warn_update_location"),this.$t("tip"),{confirmButtonText:this.$t("confirm"),cancelButtonText:this.$t("cancel")}).then(function(){return xt(i[0],i[1]).then(function(){var e=st();e.location="".concat(i[0],",").concat(i[1]),rt(e),I(t,t.$t("update_location_success"))})}).catch(function(e){e.message?x(t,e.message):"cancel"!=e&&x(t,"".concat(t.$t("update_location_fail"),": ").concat(e))})}else x(this,this.$t("err_not_select_correct"))},locate:function(){var t=this;"geolocation"in navigator?navigator.geolocation.getCurrentPosition(function(e){t.showGpsLocation(e.coords.latitude,e.coords.longitude)},function(t){console.log(t)}):console.log("Location is not avaiable")}}},za=Ga,Ha=(n("1690"),n("13b2"),Object(Bt["a"])(za,Va,Ra,!1,null,"e26267e4",null)),Wa=Ha.exports,Ya=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.visible?n("div",{staticClass:"modal",on:{click:function(e){t.visible=!1}}},[n("div",{staticClass:"content soft-scrollable"},[t.changeLog?t._l(t.changeLog,function(e){return n("div",{key:e.versionCode},[n("div",{staticClass:"version-name"},[t._v("\n          "+t._s(e.versionName)+"\n        ")]),n("ul",{staticClass:"version-content"},t._l(e.contentItems,function(e){return n("li",{key:e},[n("span",[t._v(t._s(e))])])}),0)])}):n("div",[t._v("\n      "+t._s(t.$t("loading"))+"\n    ")])],2)]):t._e()},Xa=[],Ja={data:function(){return{visible:!1}},computed:Object(Ht["a"])({},Object(Wt["c"])(["changeLog"])),methods:{show:function(){this.visible=!0},hide:function(){this.visible=!1}}},Za=Ja,Ka=(n("be1e"),Object(Bt["a"])(Za,Ya,Xa,!1,null,"5d6cd984",null)),ti=Ka.exports,ei=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.visible?n("div",{staticClass:"modal",on:{click:function(e){t.visible=!1}}},[n("div",{staticClass:"content soft-scrollable"},[t._v(t._s(t.$t("about_poem")))])]):t._e()},ni=[],ai={data:function(){return{visible:!1}},methods:{show:function(){this.visible=!0},hide:function(){this.visible=!1}}},ii=ai,si=(n("8ca2"),Object(Bt["a"])(ii,ei,ni,!1,null,"62ab3186",null)),ri=si.exports,oi=n("9f95"),ci=n.n(oi),li=n("f2d2"),ui=n.n(li),di={data:function(){return{accountInfo:null,leftSectionExited:!0,isMobileEnv:P()}},components:{Friends:yn,Letters:La,MapNode:Wa,InputBox:Oa,QuoteNode:Na,About:ri,ChangeLog:ti,Version:oe,LocaleSwitch:fe},computed:Object(Ht["a"])({},Object(Wt["c"])(["checkedFriend","friendList","mobileMode","tabletMode","nightMode"]),{logo:function(){return this.nightMode?ci.a:ui.a}}),methods:Object(Ht["a"])({},Object(Wt["b"])(["setFriends","setTheme"]),{exit:function(t){var e=this;this.$confirm(t||this.$t("warn_exit"),this.$t("tip"),{confirmButtonText:this.$t("confirm"),cancelButtonText:this.$t("cancel")}).then(function(){ot(),e.goLogin()}).catch(function(){})},goLogin:function(){this.$router.replace({name:"login"})},showMap:function(t){this.$refs.map.showMap(t)},loadFriends:function(){var t=this,e=function(){var e="location-".concat(t.accountInfo.id),n=JSON.parse(localStorage.getItem(e)||"{}");Dt().then(function(a){var i=a.data&&a.data.comments.data||[];i.forEach(function(t){if(t.avatar){var e=t.avatar.match(/user\/(.*)\/.*/);e.length>1&&(n[e[1]]=t.user_location)}}),localStorage.setItem(e,X()(n)),t.friendList.forEach(function(t){t.user_location=n[t.user_id]})}).catch(function(t){})},n=function(){Ct().then(function(n){var a=n.data;t.setFriends(sn(a.friends)),Qe(t.friendList),e()}).catch(function(e){return t.$errorHandler(e)})};Be().then(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];t.setFriends(sn(e)),0!=e.length&&__CONFIG__.useCache||n()}).catch(function(t){console.error(t),n()})},editLocation:function(){this.$refs.map.editLocation()},showAbout:function(){this.$refs.about.show()},showChangeLog:function(){this.$refs.changeLog.show()},showFeedback:function(){this.$alert(this.$t("feedback_msg"),this.$t("feedback"),{confirmButtonText:this.$t("soft_confirm")})}}),watch:{checkedFriend:function(t){this.tabletMode&&(this.leftSectionExited=!0)},tabletMode:function(){this.tabletMode||(this.leftSectionExited=!1)}},mounted:function(){var t=this;at()?(this.leftSectionExited=this.tabletMode,this.accountInfo=st(),this.accountInfo?(this.loadFriends(),Lt().then(function(t){rt(t.data)}).catch(function(e){var n=t.$errorHandler(Object(Ht["a"])({},e));n||t.exit(t.$t("fail_to_load_profile"))})):Lt().then(function(e){t.accountInfo=e.data,rt(t.accountInfo),t.loadFriends()}).catch(function(e){t.$errorHandler(Object(Ht["a"])({},e,{exitLogin:!0}))})):this.goLogin()}},hi=di,fi=(n("b3bc"),Object(Bt["a"])(hi,_e,we,!1,null,"4c442bd0",null)),pi=fi.exports,mi=n("caf9"),gi=n("b8d7");a["default"].use(Wt["a"]);var vi="is_night_mode";function _i(){var t=localStorage.getItem(vi,!1);return!0===t||"true"===t}var wi=new Wt["a"].Store({state:{checkedFriend:null,friendList:[],searchValue:"",mobileMode:!1,tabletMode:!1,changeLog:null,nightMode:_i()},mutations:{setFriends:function(t,e){t.friendList=e},checkFriend:function(t,e){t.checkedFriend=e},setSearchValue:function(t,e){t.searchValue=e},setMobileMode:function(t,e){t.mobileMode=e},setChangeLog:function(t,e){t.changeLog=e},setTabletMode:function(t,e){t.tabletMode=e},setTheme:function(t,e){t.nightMode=e,localStorage.setItem(vi,e),dn(e)}}});function bi(){wi.commit("setTabletMode",window.innerWidth<=850),wi.commit("setMobileMode",window.innerWidth<=550)}if(dn(wi.state.nightMode),bi(),window.addEventListener("resize",bi),!ae()){a["default"].use(r.a),a["default"].use(i["a"]),a["default"].use(mi["a"]),a["default"].use(gi["a"]),a["default"].config.productionTip=!1;var yi=new URL(window.location.href),Ci=yi.searchParams&&yi.searchParams.get("token");Ci&&it(Ci),window.__CONFIG__={useCache:!1},a["default"].prototype.$errorHandler=function(t){var e=t.message,n=t.exitLogin;return x(this,e),!("token_expired"!=e&&"token_invalid"!=e&&!n)&&(it(""),this.$router.replace({name:"login"}),!0)};var ki=[{path:"/login",name:"login",component:ve},{path:"/home",name:"home",component:pi},{path:"/",redirect:"/home"}],Li=new i["a"]({routes:ki});window.$rootVue=new a["default"]({router:Li,store:wi,i18n:y}),window.$rootVue.$mount("#app")}},"5f27":function(t,e,n){},"65ef":function(t,e,n){},"6c56":function(t,e,n){},"714f":function(t,e,n){},7541:function(t,e,n){"use strict";var a=n("714f"),i=n.n(a);i.a},7787:function(t,e,n){"use strict";var a=n("1d46"),i=n.n(a);i.a},"77d1":function(t,e,n){"use strict";var a=n("6c56"),i=n.n(a);i.a},"7a05":function(t,e,n){},"84aa":function(t,e,n){},"84ed":function(t,e,n){"use strict";var a=n("437e"),i=n.n(a);i.a},"8a9c":function(t,e,n){"use strict";var a=n("b1a3"),i=n.n(a);i.a},"8ca2":function(t,e,n){"use strict";var a=n("1df3"),i=n.n(a);i.a},"8fc6":function(t,e,n){"use strict";var a=n("7a05"),i=n.n(a);i.a},9087:function(t,e,n){t.exports=n.p+"img/ic_mail_out.59b2d671.png"},9407:function(t,e,n){},"9f95":function(t,e,n){t.exports=n.p+"img/ic_logo_night.c2ae6355.svg"},"9fa2":function(t,e,n){},b1a3:function(t,e,n){},b3bc:function(t,e,n){"use strict";var a=n("3f9f"),i=n.n(a);i.a},b60b:function(t,e,n){t.exports=n.p+"img/pen.f92c60b9.png"},be1e:function(t,e,n){"use strict";var a=n("dc5a"),i=n.n(a);i.a},d76f:function(t,e,n){"use strict";var a=n("ef45"),i=n.n(a);i.a},dc5a:function(t,e,n){},df96:function(t,e,n){},e266:function(t,e,n){"use strict";var a=n("84aa"),i=n.n(a);i.a},e380:function(t,e,n){t.exports=n.p+"img/ic_mail_in.25717605.png"},eb33:function(t,e,n){"use strict";var a=n("5372"),i=n.n(a);i.a},ef45:function(t,e,n){},f2d2:function(t,e,n){t.exports=n.p+"img/ic_logo.53d14635.svg"},f642:function(t,e,n){"use strict";var a=n("9407"),i=n.n(a);i.a},fa5a:function(t,e,n){},fb4b:function(t,e,n){},ff11:function(t,e,n){}});
//# sourceMappingURL=app.c0dc59a8.js.map